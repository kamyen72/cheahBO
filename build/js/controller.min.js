"use strict";app.controller("betReportController",["$q","$scope","$rootScope","$location","$timeout","$translate","localStorageService","blockUI","ngAuthSettings","authService","lotteryService","mplayerService",function(e,r,a,t,o,s,y,l,c,n,d,i){r.dataSource={lotteryClassObj:[],SelectLotteryClass:{},mPlayerDetail:{},listData:[],mPlayerObj:[],pageStatus:"reportView",searchCondition:{StatusCode:1},PagerObj:{CurrentPage:1,PageSize:10,TotalItems:0,PageArray:[],PageRangeMax:10,PageRangeMin:1,thisPage:1}},r.search=function(){var t=[];r.dataSource.SelectLotteryType&&0<r.dataSource.SelectLotteryType.LotteryTypeID?t.push(r.dataSource.SelectLotteryType.LotteryTypeID):r.dataSource.SelectLotteryClass.lotteryTypes.forEach(e=>{e.LotteryTypeID&&t.push(e.LotteryTypeID)});var e={CurrentPage:r.dataSource.PagerObj.CurrentPage,PageSize:r.dataSource.PagerObj.PageSize,UserName:r.dataSource.searchCondition.UserName,LotteryTypeIDs:t,StatusCode:r.dataSource.searchCondition.StatusCode,DateS:r.dataSource.searchCondition.DateS,DateE:r.dataSource.searchCondition.DateE,IsStaging:IS_STAGING};d.findMPlayerTotalSum(e).then(function(e){"000"===e.data.APIRes.ResCode?(console.log(e.data.Rows),r.dataSource.listData=e.data.Rows.ObjectListData,r.dataSource.listData.push({UserName:"Total",TurnOver:r.dataSource.listData.reduce(sumFunction("TurnOver"),0),BetAmount:r.dataSource.listData.reduce(sumFunction("BetAmount"),0),WinLose:r.dataSource.listData.reduce(sumFunction("WinLose"),0),WinMoney:r.dataSource.listData.reduce(sumFunction("WinMoney"),0)}),r.dataSource.listData.push({UserName:"Grand Total",TurnOver:e.data.Rows.ObjectQryData.TotalTurnover,BetAmount:e.data.Rows.ObjectQryData.TotalBetAmount,WinLose:e.data.Rows.ObjectQryData.TotalWinLose,WinMoney:e.data.Rows.ObjectQryData.TotalWinMoney}),r.dataSource.PagerObj=e.data.Rows.PagerObj,r.dataSource.PagerObj.thisPage=r.dataSource.PagerObj.CurrentPage,r.dataSource.PagerObj.thisPageSize=r.dataSource.PagerObj.PageSize,r.dataSource.PagerObj.PageArray=[]):(c.modalMsg.title="Information",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,c.modalMsg.callBack="home",a.$broadcast("changeModalMsg"),$("#ModalShow").click())},function(e){})},r.showDetail=function(e){if(r.dataSource.mPlayerDetail=JSON.parse(JSON.stringify(e)),r.dataSource.mPlayerDetail.vwMPlayers&&0<r.dataSource.mPlayerDetail.vwMPlayers.length){for(var t=0;t<r.dataSource.mPlayerDetail.vwMPlayers.length;t++){var a,o=r.dataSource.mPlayerDetail.vwMPlayers[t].LotteryInfoName.split("_");1<o.length&&(a=r.dataSource.mPlayerDetail.vwMPlayers[t].SelectedTxt.split("|"),r.dataSource.mPlayerDetail.vwMPlayers[t].SelectedTxt=o[0]+"|"+a[1]+"|"+a[2])}if(5===r.dataSource.mPlayerDetail.vwMPlayers[0].LotteryClassID){let e=r.dataSource.mPlayerDetail.oLottery.Result.split(",").reverse();e=e.map(e=>e.toString().padStart(4,0)),r.dataSource.mPlayerDetail.oLottery.Result=e.join(", ")}r.dataSource.mPlayerDetail.vwMPlayers.push({Price:r.dataSource.mPlayerDetail.vwMPlayers.reduce(sumFunction("Price"),0),DiscountPrice:r.dataSource.mPlayerDetail.vwMPlayers.reduce(sumFunction("DiscountPrice"),0),WinMoney:r.dataSource.mPlayerDetail.vwMPlayers.reduce(sumFunction("WinMoney"),0),WinLose:r.dataSource.mPlayerDetail.vwMPlayers.reduce(sumFunction("WinLose"),0)})}},r.init=function(){r.findLotteryTypeLobby()},r.findLotteryTypeLobby=function(){d.findLotteryTypeLobby({},c.header).then(function(e){e&&e.data&&"000"===e.data.APIRes.ResCode?(r.dataSource.lotteryClassObj=(e.data.Rows.ListData||[]).map(e=>({LotteryClassName:e.LotteryTypeName,LotteryClassLabel:e.LotteryTypeName,LotteryClassLangKey:`Lobby_${e.LotteryTypeName}`,LotteryTypeIDList:(e.LotteryTypeCode||"").split(",").map(e=>parseInt(e)),LotteryTypes:[]})),r.dataSource.lotteryClassObj.unshift({ID:-1,LotteryClassName:"--Game Class--",LotteryClassLabel:"--Game Class--",LotteryTypeIDList:[],LotteryTypes:[]}),r.findLotteryClass()):(c.modalMsg.title="FindLotteryTypeLobby",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,a.$broadcast("changeModalMsg"),$("#ModalShow").click())},function(e){})},r.findLotteryClass=function(){var e=new Date,e=e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate();d.findLotteryClass({CurrentPage:1,PageSize:1e5,DateS:e+" 00:00:00",DateE:e+" 23:59:59",Status:!0},c.headers).then(function(e){var a;e&&e.data&&"000"===e.data.APIRes.ResCode?(a=(e.data.Rows.ListData||[]).reduce((e,t)=>{if(6===t.LotteryClassID)return e;t=t.lotteryTypes.map(e=>({...e,LotteryTypeLabel:e.LotteryTypeCode,LotteryTypeLangKey:`Lobby_${e.LotteryTypeCode}`}));return[...e,...t]},[]),r.dataSource.totalLotteryTypes=a,r.dataSource.lotteryClassObj.forEach(t=>{t.lotteryTypes=a.filter(e=>(t.LotteryTypeIDList||[]).includes(e.LotteryTypeID)),t.lotteryTypes.unshift({ID:-1,LotteryTypeCode:"--Game Type--",LotteryTypeLabel:"--Game Type--"})}),r.dataSource.SelectLotteryClass=r.dataSource.lotteryClassObj[0],r.getOptionsTranslate(),r.secondSelected(),r.dateSearch(0,0)):(c.modalMsg.title="FindLotteryClass",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode)},function(e){console.log(e)})},r.secondSelected=function(){r.dataSource.lotteryTypes=[],r.dataSource.SelectLotteryClass.lotteryTypes&&(r.dataSource.lotteryTypes=r.dataSource.SelectLotteryClass.lotteryTypes),r.dataSource.SelectLotteryType=r.dataSource.lotteryTypes[0]},r.getOptionsTranslate=function(){var t=[];r.dataSource.lotteryClassObj.forEach(e=>{t.push(e.LotteryClassLangKey),e.lotteryTypes.forEach(e=>{t.push(e.LotteryTypeLangKey)})}),s(t).then(a=>{r.dataSource.lotteryClassObj.forEach(t=>{t.LotteryClassLabel=a[t.LotteryClassLangKey]||t.LotteryClassName,console.log(t.LotteryClassLabel,t.LotteryClassLangKey,t.LotteryClassName),t.lotteryTypes.forEach(e=>{e.LotteryTypeLabel=a[e.LotteryTypeLangKey]||e.LotteryTypeCode,console.log(t.LotteryTypeLabel,e.LotteryTypeLangKey,e.LotteryTypeCode)})})}).catch(()=>{});var a=[];r.dataSource.SelectLotteryType&&0<r.dataSource.SelectLotteryType.LotteryTypeID?a.push(r.dataSource.SelectLotteryType.LotteryTypeID):r.dataSource.SelectLotteryClass.lotteryTypes.forEach(e=>{e.LotteryTypeID&&a.push(e.LotteryTypeID)})},setTimeout(r.init,300),r.dateSearch=function(e,t){var a=new Date,o=new Date(Number(a));o.setDate(a.getDate()+e);e=new Date(Number(a));e.setDate(a.getDate()+t),r.dataSource.searchCondition.DateS=o,r.dataSource.searchCondition.DateE=e,r.search()},r.showBets=function(e){r.dataSource.pageStatus="detailView";var t=[];r.dataSource.SelectLotteryType&&0<r.dataSource.SelectLotteryType.LotteryTypeID?t.push(r.dataSource.SelectLotteryType.LotteryTypeID):r.dataSource.SelectLotteryClass.lotteryTypes.forEach(e=>{e.LotteryTypeID&&t.push(e.LotteryTypeID)});e={CurrentPage:r.dataSource.PagerObj.CurrentPage,PageSize:r.dataSource.PagerObj.PageSize,UserName:r.dataSource.searchCondition.UserName,GameDealerMemberID:e.GameDealerMemberID,LotteryTypeIDs:t,StatusCode:r.dataSource.searchCondition.StatusCode,DateS:r.dataSource.searchCondition.DateS,DateE:r.dataSource.searchCondition.DateE,IsStaging:IS_STAGING};d.findUserVwMPlayer(e).then(function(e){"000"===e.data.APIRes.ResCode?(console.log(e.data),r.dataSource.mPlayerObj=e.data.Rows.ListData):(c.modalMsg.title="Information",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,c.modalMsg.callBack="home",a.$broadcast("changeModalMsg"),$("#ModalShow").click())},function(e){})},r.showReport=function(){r.dataSource.pageStatus="reportView"},r.PageChanged=function(e){r.dataSource.PagerObj.CurrentPage=e,r.search()},r.copy=function(){var e=document.body;copy(e,document,"winLoseReport")},r.excel=function(){var e=c.apiServiceBaseUri+"/api/GameDealerMPlayer/GetBetReportExcel";e+="?dateS="+getDateS(r.dataSource.searchCondition.DateS),e+="&dateE="+getDateE(r.dataSource.searchCondition.DateE),e+="&companyID="+y.get("UserInfo").CompanyID,window.open(e)},r.print=function(){print(document,"winLoseReport")},r.openVideo=function(t){d.checkVideoUploadS3({CurrentPeriod:t}).then(function(e){"000"===e.data.APIRes.ResCode?window.open(`https://static.pisang102.com/3mlive/VideoRecord/${t}.mp4`,"_blank"):(c.modalMsg.title="Information",c.modalMsg.msg="Video sedang dimuat, silakan dicoba beberapa saat lagi.",c.modalMsg.callBack="",$("#ModalShow").click())},function(e){})}}]);
"use strict";app.controller("gameRoomTypeController",["$scope","$rootScope","$location","$timeout","localStorageService","blockUI","ngAuthSettings","authService","gameRoomService","lotteryService","betLimitSettingService",function(d,l,e,a,t,n,c,o,s,r,g){n.start(),d.dataSource={pageStatus:"lotteryTypeView",searchCondition:{CurrentPage:1,PageSize:500},gameRoomTypeListData:[],gameRoomTypeInfo:{},lotteryClassListData:[],lotteryClassInfo:{},lotteryTypeListData:[],lotteryTypeInfo:{vwLotteryTypeLimit:[],Color:{value:"magnumYellow",code:"#e9bb29"},SelOpenDayOfWeek:[{value:7,selected:!1},{value:1,selected:!1},{value:2,selected:!1},{value:3,selected:!1},{value:4,selected:!1},{value:5,selected:!1},{value:6,selected:!1}],image:[]},lotteryInfoListData:[],lotteryInfo:{vwLotteryInfoLimit:[]},defaultSpecial4DLotteryType:{},special4DLotteryType:{},betLimitList:[],platform:{},PagerObj:{CurrentPage:1,PageSize:10,TotalItems:0,PageArray:[],PageRangeMax:10,PageRangeMin:1,thisPage:1},PagerObj2:{CurrentPage:1,PageSize:10,TotalItems:0,PageArray:[],PageRangeMax:10,PageRangeMin:1,thisPage:1},PagerObj3:{CurrentPage:1,PageSize:10,TotalItems:0,PageArray:[],PageRangeMax:10,PageRangeMin:1,thisPage:1},PagerObj4:{CurrentPage:1,PageSize:10,TotalItems:0,PageArray:[],PageRangeMax:10,PageRangeMin:1,thisPage:1},openData:{},EditPassword:{isShow:!0,type:null,Pwd:null,ConfirmPwd:null},callBack:null,parameter:{},agent4dColor:[{value:"magnumYellow",code:"#e9bb29"},{value:"dirwanBlue",code:"#1c1684"},{value:"totoRed",code:"#ff5f5f"},{value:"sandakanColor",code:"#008a10"},{value:"SydneyOrange",code:"#f47520"},{value:"poolsBlue",code:"#004a90"},{value:"constellationGreen",code:"rgb(1, 60, 45)"},{value:"constellationBlue",code:"rgb(4, 62, 178)"},{value:"constellationPurple",code:"rgb(108, 4, 178)"}],IsSpecialAgent:!1},d.init=function(){var e=t.get("UserInfo");d.dataSource.IsSpecialAgent=e.IsSpecialAgent,d.dataSource.platform=t.get("PlatformSetting"),d.searchLotteryClass(),d.getDefaultSpecial4DLotteryType(),d.getSpecial4DLotteryType()},a(d.init,100),d.updateEditPassword=function(e){!l.valid(e)&&d.dataSource.EditPassword.type?d.checkGamePwd():d.searchLotteryType()},d.closePwd=function(){d.searchLotteryType()},d.checkGamePwd=function(){d.dataSource.openData.GamePwd=d.dataSource.EditPassword.Pwd,r.checkGamePwd(d.dataSource.openData).then(function(e){"000"===e.data.APIRes.ResCode?d.dataSource.callBack(d.dataSource.parameter):(c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,l.$broadcast("changeModalMsg"))},function(e){console.log(e)})},d.checkPwd=function(e,a){d.dataSource.parameter=void 0!==a?a:{},(d.dataSource.callBack=e)(a)},d.searchBetLimit=function(){g.find({CurrentPage:1,PageSize:1e4}).then(function(e,a,t,o){"000"===e.data.APIRes.ResCode?d.dataSource.betLimitList=e.data.Rows.ListData:(c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,l.$broadcast("changeModalMsg"))},function(e,a,t,o){})},d.searchGameRoomType=function(){d.dataSource.searchCondition.CurrentPage=d.dataSource.PagerObj.CurrentPage,d.dataSource.searchCondition.PageSize=d.dataSource.PagerObj.PageSize,s.find(d.dataSource.searchCondition).then(function(e,a,t,o){"000"===e.data.APIRes.ResCode?(d.dataSource.gameRoomTypeListData=e.data.Rows.ListData,d.dataSource.PagerObj=e.data.Rows.PagerObj,d.dataSource.PagerObj.thisPage=d.dataSource.PagerObj.CurrentPage,d.dataSource.PagerObj.thisPageSize=d.dataSource.PagerObj.PageSize,d.dataSource.PagerObj.PageArray=[]):(c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,l.$broadcast("changeModalMsg")),n.stop()},function(e,a,t,o){n.stop()})},d.addOrEditGameRoomType=function(e){l.valid(e)||(d.dataSource.gameRoomTypeInfo.GameRoomID?s.update(d.dataSource.gameRoomTypeInfo).then(function(e){"000"===e.data.APIRes.ResCode?(c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,l.$broadcast("changeModalMsg"),d.searchGameRoomType()):(c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,l.$broadcast("changeModalMsg"))},function(e,a,t,o){}):s.add(d.dataSource.gameRoomTypeInfo).then(function(e){"000"===e.data.APIRes.ResCode?(c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,l.$broadcast("changeModalMsg"),d.searchGameRoomType()):(c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,l.$broadcast("changeModalMsg"))},function(e,a,t,o){}))},d.deleteGameRoomType=function(e){d.dataSource.gameRoomTypeInfo=e,c.modalMsg.title="Confirm",c.modalMsg.msg="ConfirmDelete",c.modalMsg.type="000",c.modalMsg.callBack="confirmDelGameRoomType",l.$broadcast("changeModalMsg",!0)},d.$on("confirmDelGameRoomType",function(e){s.delete(d.dataSource.gameRoomTypeInfo).then(function(e){"000"===e.data.APIRes.ResCode?(c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,c.modalMsg.callBack="showSearch",l.$broadcast("changeModalMsg"),d.searchGameRoomType()):(c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,l.$broadcast("changeModalMsg"),d.dataSource.errorMsg=e.data.APIRes.ResMessage)},function(e,a,t,o){})}),d.changeAndSaveGameRoomType=function(e){d.dataSource.gameRoomTypeInfo=e,d.addOrEditGameRoomType()},d.showGameRoomAdd=function(){d.dataSource.gameRoomTypeInfo={},$("#ShowGameRoomDialog").click()},d.showGameRoomEdit=function(e){d.dataSource.gameRoomTypeInfo=e,$("#ShowGameRoomDialog").click()},d.showLotteryClass=function(e){d.dataSource.gameRoomTypeInfo=e,d.dataSource.pageStatus="lotteryClassView",d.dataSource.lotteryClassListData=[],d.dataSource.lotteryClassInfo={},d.dataSource.lotteryTypeListData=[],d.dataSource.lotteryTypeInfo={},d.dataSource.lotteryInfoListData=[],d.dataSource.lotteryInfo={},d.searchLotteryClass()},d.searchLotteryClass=function(){d.dataSource.searchCondition.CurrentPage=d.dataSource.PagerObj2.CurrentPage,d.dataSource.searchCondition.PageSize=d.dataSource.PagerObj2.PageSize,d.dataSource.searchCondition.GameRoomID=d.dataSource.gameRoomTypeInfo.GameRoomID,r.findLotteryClass(d.dataSource.searchCondition).then(function(e,a,t,o){if("000"===e.data.APIRes.ResCode){console.log(e.data.Rows.ListData),d.dataSource.lotteryClassListData=e.data.Rows.ListData.filter(e=>6!==e.LotteryClassID),d.dataSource.lotteryClassListData.unshift({LotteryClassID:-1,LotteryClassName:"All",GameRoomID:1});const r=d.dataSource.lotteryClassListData.find(e=>5===e.LotteryClassID);r.IsAgentGame=!1,r.lotteryTypes=r.lotteryTypes.filter(e=>!1===e.IsAgentGame);var s=r.lotteryTypes.filter(e=>!0===e.IsAgentGame);d.dataSource.lotteryClassListData.push({LotteryClassID:5,LotteryClassName:"Special 4D",GameRoomID:1,lotteryTypes:s,IsAgentGame:!0}),d.dataSource.lotteryClassListData=d.dataSource.lotteryClassListData.filter(e=>!0===e.IsAgentGame),d.dataSource.lotteryClassInfo=d.dataSource.lotteryClassListData[0],console.log(d.dataSource.lotteryClassInfo),d.dataSource.PagerObj2=e.data.Rows.PagerObj,d.dataSource.PagerObj2.thisPage=d.dataSource.PagerObj2.CurrentPage,d.dataSource.PagerObj2.thisPageSize=d.dataSource.PagerObj2.PageSize,d.dataSource.PagerObj2.PageArray=[],d.searchLotteryType()}else c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,l.$broadcast("changeModalMsg");n.stop()},function(e,a,t,o){n.stop()})},d.addOrEditLotteryClass=function(e){l.valid(e)||(d.dataSource.lotteryClassInfo.LotteryClassID?r.updateLotteryClass(d.dataSource.lotteryClassInfo).then(function(e){e.data.APIRes.ResCode,c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,l.$broadcast("changeModalMsg")},function(e,a,t,o){}):r.addLotteryClass(d.dataSource.lotteryClassInfo).then(function(e){e.data.APIRes.ResCode,c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,l.$broadcast("changeModalMsg")},function(e){}))},d.deleteLotteryClass=function(e){d.dataSource.lotteryClassInfo=e,c.modalMsg.title="Confirm",c.modalMsg.msg="ConfirmDelete",c.modalMsg.type="000",c.modalMsg.callBack="confirmDelLotteryClassInfo",l.$broadcast("changeModalMsg",!0)},d.$on("confirmDelLotteryClassInfo",function(e){r.delLotteryClass(d.dataSource.lotteryClassInfo).then(function(e){"000"===e.data.APIRes.ResCode?(c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,c.modalMsg.callBack="showSearch",l.$broadcast("changeModalMsg"),d.searchLotteryClass()):(c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,l.$broadcast("changeModalMsg"),d.dataSource.errorMsg=e.data.APIRes.ResMessage)},function(e,a,t,o){})}),d.changeAndSaveLotteryClass=function(e){d.dataSource.lotteryClassInfo=e,d.addOrEditLotteryClass()},d.showLotteryClassAdd=function(){d.dataSource.lotteryClassInfo={},$("#ShowLotteryClassDialog").click()},d.showLotteryClassEdit=function(e){d.dataSource.lotteryClassInfo=e,$("#ShowLotteryClassDialog").click()},d.showLotteryType=function(e){d.dataSource.lotteryClassInfo=e,d.dataSource.pageStatus="lotteryTypeView",d.dataSource.lotteryTypeListData=[],d.dataSource.lotteryTypeInfo={},d.dataSource.lotteryInfoListData=[],d.dataSource.lotteryInfo={},d.searchLotteryType()},d.searchLotteryType=function(){d.dataSource.searchCondition.CurrentPage=d.dataSource.PagerObj3.CurrentPage,d.dataSource.searchCondition.PageSize=d.dataSource.PagerObj3.PageSize,d.dataSource.searchCondition.LotteryClassID=d.dataSource.lotteryClassInfo.LotteryClassID,d.dataSource.searchCondition.IsAgentGame=d.dataSource.lotteryClassInfo.IsAgentGame,console.log(d.dataSource.searchCondition),r.findLotteryType(d.dataSource.searchCondition).then(function(e,a,t,o){n.stop(),"000"===e.data.APIRes.ResCode?(console.log(e.data.Rows.ListData),d.dataSource.lotteryTypeListData=e.data.Rows.ListData,d.dataSource.PagerObj3=e.data.Rows.PagerObj,d.dataSource.PagerObj3.thisPage=d.dataSource.PagerObj3.CurrentPage,d.dataSource.PagerObj3.thisPageSize=d.dataSource.PagerObj3.PageSize,d.dataSource.PagerObj3.PageArray=[]):(c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,l.$broadcast("changeModalMsg"))},function(e,a,t,o){})},d.getDefaultSpecial4DLotteryType=function(){r.getDefaultSpecial4DLotteryType().then(function(e,a,t,o){n.stop(),"000"===e.data.APIRes.ResCode?d.dataSource.defaultSpecial4DLotteryType=e.data.Rows.QryData:(c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,l.$broadcast("changeModalMsg"))},function(e,a,t,o){})},d.getSpecial4DLotteryType=function(){r.getSpecial4DLotteryType().then(function(e,a,t,o){n.stop(),"000"===e.data.APIRes.ResCode?(d.dataSource.special4DLotteryType=e.data.Rows.QryData,console.log(d.dataSource.special4DLotteryType)):(c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,l.$broadcast("changeModalMsg"))},function(e,a,t,o){})},d.addOrEditLotteryType=function(e){if(!l.valid(e))if(n.start(),d.dataSource.lotteryTypeInfo.LotteryClassID=5,d.dataSource.lotteryTypeInfo.IsOfficial=!0,d.dataSource.lotteryTypeInfo.IsAgentGame=!0,d.dataSource.lotteryTypeInfo.image&&0<d.dataSource.lotteryTypeInfo.image.length&&(d.dataSource.lotteryTypeInfo.Base64Img=d.dataSource.lotteryTypeInfo.image[0].file,d.dataSource.lotteryTypeInfo.FileName=d.dataSource.lotteryTypeInfo.image[0].name,d.dataSource.lotteryTypeInfo.FileExtension=d.dataSource.lotteryTypeInfo.image[0].extension),d.dataSource.lotteryTypeInfo.SelOpenDayOfWeek&&(d.dataSource.lotteryTypeInfo.OpenDayOfWeek=d.dataSource.lotteryTypeInfo.SelOpenDayOfWeek.filter(e=>e.selected).map(e=>e.value).join(",")),0<=d.dataSource.lotteryTypeInfo.selHour&&d.dataSource.lotteryTypeInfo.selMinute&&(d.dataSource.lotteryTypeInfo.CurrentLotteryTime=d.dataSource.lotteryTypeInfo.selHour+":"+d.dataSource.lotteryTypeInfo.selMinute),d.dataSource.lotteryTypeInfo.SelColor&&(d.dataSource.lotteryTypeInfo.Color=d.dataSource.lotteryTypeInfo.SelColor.value),d.dataSource.lotteryTypeInfo.LotteryTypeID){var a="";if(d.dataSource.lotteryTypeInfo.image&&0<d.dataSource.lotteryTypeInfo.image.length&&(120==document.getElementById("uploadImage").naturalHeight&&120==document.getElementById("uploadImage").naturalWidth||(a+="Image size must be 120x120 <br />")),a)return c.modalMsg.title="Message",c.modalMsg.msg=a,l.$broadcast("changeModalMsg"),void n.stop();r.updateLotteryType(d.dataSource.lotteryTypeInfo).then(function(e){n.stop(),e.data.APIRes.ResCode,c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,l.$broadcast("changeModalMsg"),d.searchLotteryType()},function(e,a,t,o){n.stop()})}else{a="";if(!d.dataSource.lotteryTypeInfo.image||d.dataSource.lotteryTypeInfo.image.length<=0?a+="Please Select 4D Image <br />":120==document.getElementById("uploadImage").naturalHeight&&120==document.getElementById("uploadImage").naturalWidth||(a+="Image size must be 120x120 <br />"),d.dataSource.lotteryTypeInfo.CurrentLotteryTime||(a+="Please Select Current Lottery Time <br />"),d.dataSource.lotteryTypeInfo.OpenDayOfWeek||(a+="Please Select Open Day Of Week <br />"),a)return c.modalMsg.title="Message",c.modalMsg.msg=a,l.$broadcast("changeModalMsg"),void n.stop();r.addLotteryType(d.dataSource.lotteryTypeInfo).then(function(e){"000"===e.data.APIRes.ResCode?(c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,l.$broadcast("changeModalMsg"),d.getSpecial4DLotteryType()):(c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,l.$broadcast("changeModalMsg")),d.searchLotteryType()},function(e,a,t,o){n.stop()})}},d.deleteLotteryType=function(e){d.dataSource.lotteryTypeInfo=e,c.modalMsg.title="Confirm",c.modalMsg.msg="ConfirmDelete",c.modalMsg.type="000",c.modalMsg.callBack="confirmDelLotteryType",l.$broadcast("changeModalMsg",!0)},d.$on("confirmDelLotteryType",function(e){r.delLotteryType(d.dataSource.lotteryTypeInfo).then(function(e){"000"===e.data.APIRes.ResCode?(c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,c.modalMsg.callBack="showSearch",l.$broadcast("changeModalMsg"),d.searchLotteryType()):(c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,l.$broadcast("changeModalMsg"),d.dataSource.errorMsg=e.data.APIRes.ResMessage)},function(e,a,t,o){})}),d.changeAndSaveLotteryType=function(e){d.dataSource.lotteryTypeInfo=e,d.addOrEditLotteryType()},d.showLotteryTypeAdd=function(){var e=0<d.dataSource.special4DLotteryType.LotteryTypeID?parseInt(d.dataSource.special4DLotteryType.LotteryTypeName.substring(d.dataSource.special4DLotteryType.LotteryTypeName.length-3)):0,a=d.dataSource.platform.APICode+(e+1).toString().padStart(3,"0"),e=d.dataSource.defaultSpecial4DLotteryType;d.$broadcast("clearImage"),d.dataSource.lotteryTypeInfo={vwLotteryTypeLimit:[],LotteryClassID:5,LotteryTypeName:a,LotteryTypeCode:a,PeriodInterval:e.PeriodInterval,MaxBonusMoneyPool:e.MaxBonusMoneyPool,DrawBonusPercentage:e.DrawBonusPercentage,CompanyWinPercentage:e.CompanyWinPercentage,UserWinPercentage:e.UserWinPercentage,CompanyPresetCompensation:e.CompanyPresetCompensation,AIType:e.AIType,IsAgentGame:!0,Status:!0,SelColor:d.dataSource.agent4dColor[0],selHour:0,selMinute:"00",SelOpenDayOfWeek:[{value:0,selected:!1},{value:1,selected:!1},{value:2,selected:!1},{value:3,selected:!1},{value:4,selected:!1},{value:5,selected:!1},{value:6,selected:!1}]},$("#ShowLotteryTypeDialog").click()},d.showLotteryTypeEdit=function(e){if(d.dataSource.lotteryTypeInfo=e,d.dataSource.lotteryTypeInfo.URL.includes("color")&&(d.dataSource.lotteryTypeInfo.SelColor=d.dataSource.agent4dColor.find(e=>e.value==d.dataSource.lotteryTypeInfo.URL.split("?")[1].replace("color=",""))),d.dataSource.lotteryTypeInfo.OpenDayOfWeek){d.dataSource.lotteryTypeInfo.SelOpenDayOfWeek=[];const a=d.dataSource.lotteryTypeInfo.OpenDayOfWeek.split(",");for(let e=0;e<7;e++)a.includes(e.toString())?d.dataSource.lotteryTypeInfo.SelOpenDayOfWeek.push({value:e,selected:!0}):d.dataSource.lotteryTypeInfo.SelOpenDayOfWeek.push({value:e,selected:!1})}d.dataSource.lotteryTypeInfo.CurrentLotteryTime&&(d.dataSource.lotteryTypeInfo.selHour=parseInt(d.dataSource.lotteryTypeInfo.CurrentLotteryTime.split(":")[0]),d.dataSource.lotteryTypeInfo.selMinute=d.dataSource.lotteryTypeInfo.CurrentLotteryTime.split(":")[1]),d.$broadcast("clearImage"),$("#ShowLotteryTypeDialog").click()},d.showLotteryInfo=function(e){d.dataSource.lotteryTypeInfo=e,d.dataSource.pageStatus="lotteryInfoView",d.dataSource.lotteryInfoListData=[],d.dataSource.lotteryInfo={},d.searchLotteryInfo()},d.searchLotteryInfo=function(){d.dataSource.searchCondition.CurrentPage=d.dataSource.PagerObj4.CurrentPage,d.dataSource.searchCondition.PageSize=d.dataSource.PagerObj4.PageSize,d.dataSource.searchCondition.LotteryTypeID=d.dataSource.lotteryTypeInfo.LotteryTypeID,d.dataSource.searchCondition.Status=!1,r.findLotteryInfo(d.dataSource.searchCondition).then(function(e,a,t,o){"000"===e.data.APIRes.ResCode?(console.log(e.data.Rows.ListData),d.dataSource.lotteryInfoListData=e.data.Rows.ListData,d.dataSource.lotteryInfoListData.forEach(e=>{var a=(a=JSON.parse(e.SelectArray).map(e=>{return e.odds?e.text+":"+e.odds:""})).filter(e=>""!==e);e.ShowOdds=a.join(",")}),d.dataSource.PagerObj4=e.data.Rows.PagerObj,d.dataSource.PagerObj4.thisPage=d.dataSource.PagerObj4.CurrentPage,d.dataSource.PagerObj4.thisPageSize=d.dataSource.PagerObj4.PageSize,d.dataSource.PagerObj4.PageArray=[]):(c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,l.$broadcast("changeModalMsg")),n.stop()},function(e,a,t,o){n.stop()})},d.addOrEditLotteryInfo=function(e){l.valid(e)||(d.dataSource.lotteryInfo.LotteryTypeID=d.dataSource.lotteryTypeInfo.LotteryTypeID,d.dataSource.lotteryInfo.DisCount=d.dataSource.lotteryInfo.DisCount/100,d.dataSource.lotteryInfo.SelectArrayModel&&(d.dataSource.lotteryInfo.SelectArrayModel.forEach(e=>{d.dataSource.lotteryInfo.OneOdd&&(e.odds=d.dataSource.lotteryInfo.SelectArrayModel[0].odds),e.odds||delete e.odds,delete e.$$hashKey}),d.dataSource.lotteryInfo.SelectArray=JSON.stringify(d.dataSource.lotteryInfo.SelectArrayModel)),d.dataSource.lotteryInfo.LotteryInfoID?r.updateLotteryInfo(d.dataSource.lotteryInfo).then(function(e){"000"===e.data.APIRes.ResCode?(c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,l.$broadcast("changeModalMsg"),d.searchLotteryInfo()):(c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,l.$broadcast("changeModalMsg"))},function(e){console.log(e)}):r.addLotteryInfo(d.dataSource.lotteryInfo).then(function(e){"000"===e.data.APIRes.ResCode?(c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,l.$broadcast("changeModalMsg"),d.searchLotteryInfo()):(c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,l.$broadcast("changeModalMsg"))},function(e){}))},d.deleteLotteryInfo=function(e){d.dataSource.lotteryInfo=e,c.modalMsg.title="Confirm",c.modalMsg.msg="ConfirmDelete",c.modalMsg.type="000",c.modalMsg.callBack="confirmDelLotteryInfo",l.$broadcast("changeModalMsg",!0)},d.$on("confirmDelLotteryInfo",function(e){r.delLotteryInfo(d.dataSource.lotteryInfo).then(function(e){"000"===e.data.APIRes.ResCode?(c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,c.modalMsg.callBack="showSearch",l.$broadcast("changeModalMsg"),d.searchLotteryInfo()):(c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,l.$broadcast("changeModalMsg"))},function(e){console.log(e)})}),d.changeAndSaveLotteryInfo=function(e){d.dataSource.lotteryInfo=e,d.addOrEditLotteryInfo()},d.showLotteryInfoAdd=function(){d.dataSource.lotteryInfo={vwLotteryInfoLimit:[],SelectArrayModel:{}},$("#ShowLotteryInfoDialog").click()},d.showLotteryInfoEdit=function(e){d.dataSource.lotteryInfo={},$.extend(d.dataSource.lotteryInfo,e),d.dataSource.lotteryInfo.SelectArray&&(d.dataSource.lotteryInfo.SelectArrayModel=JSON.parse(d.dataSource.lotteryInfo.SelectArray)),d.dataSource.lotteryInfo.DisCount&&(d.dataSource.lotteryInfo.DisCount=(100*d.dataSource.lotteryInfo.DisCount).toFixed(0)),$("#ShowLotteryInfoDialog").click()},d.addBetLimit=function(e){e.push({LotteryClassID:d.dataSource.lotteryClassInfo.LotteryClassID||0,LotteryTypeID:d.dataSource.lotteryTypeInfo.LotteryTypeID||0,LotteryInfoID:d.dataSource.lotteryInfo.LotteryInfoID||0})},d.deleteBetLimit=function(t,o){var e;0<o.LotteryBetLimitMapID?g.deleteMap(o).then(function(e){var a;"000"===e.data.APIRes.ResCode?(c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,l.$broadcast("changeModalMsg"),-1<(a=t.indexOf(o))&&t.splice(a,1)):(c.modalMsg.title="Message",c.modalMsg.msg=e.data.APIRes.ResMessage,c.modalMsg.type=e.data.APIRes.ResCode,l.$broadcast("changeModalMsg"))},function(e){console.log(e)}):-1<(e=t.indexOf(o))&&t.splice(e,1)},d.PageChanged=function(e){d.dataSource.PagerObj.CurrentPage=e,d.searchGameRoomType()},d.PageChanged2=function(e){d.dataSource.PagerObj2.CurrentPage=e,d.searchLotteryClass()},d.PageChanged3=function(e){d.dataSource.PagerObj3.CurrentPage=e,d.searchLotteryType()},d.PageChanged4=function(e){d.dataSource.PagerObj4.CurrentPage=e,d.searchLotteryInfo()}}]);
"use strict";app.controller("homeController",["$scope","$rootScope","$location","$timeout","localStorageService","blockUI","ngAuthSettings","authService","memberShipService","depositService","promotionSettingsService","cbrsService","mplayerService",function(s,i,t,e,a,o,d,r,c,l,u,h,m){o.start();var n=new Date;s.dataSource={menuList:[],searchCondition:{CurrentPage:1,PageSize:9999999,DateS:new Date(n.setMonth(n.getMonth()-6)),DateE:new Date},arrMonth:[],arrMonthIdx:[],arrGames:["GPRacing","2DNumberGame","HKLotto","Sicbo","4DLotto"],memberListData:[],depositListData:[],mPromotionListData:[],cbrsListData:[],mPlayListData:[]},s.querySubmit=function(){console.log(s.chooseUrl)},s.init=function(){d.modalMsg.linkTo="",o.stop()},s.getData=function(){var r=!0,t=c.findUser(s.dataSource.searchCondition).then(function(t,e,a){"000"===t.data.APIRes.ResCode?s.dataSource.memberListData=t.data.Rows.ListData:(d.modalMsg.title="Message",d.modalMsg.msg=t.data.APIRes.ResMessage,d.modalMsg.type=t.data.APIRes.ResCode)},function(t,e,a){r=!1}),e=l.findDepositHistory(s.dataSource.searchCondition).then(function(t,e,a){"000"===t.data.APIRes.ResCode?s.dataSource.depositListData=t.data.Rows.ListData:(d.modalMsg.title="Message",d.modalMsg.msg=t.data.APIRes.ResMessage,d.modalMsg.type=t.data.APIRes.ResCode)},function(t,e,a){r=!1}),a=u.findVwMPromotions(s.dataSource.searchCondition).then(function(t){"000"===t.data.APIRes.ResCode?s.dataSource.mPromotionListData=t.data.Rows.ListData:(d.modalMsg.title="Message",d.modalMsg.msg=t.data.APIRes.ResMessage,d.modalMsg.type=t.data.APIRes.ResCode)},function(t){r=!1}),o=h.findCBRReport(s.dataSource.searchCondition).then(function(t,e,a,o){"000"===t.data.APIRes.ResCode?s.dataSource.cbrsListData=t.data.Rows:(d.modalMsg.title="Message",d.modalMsg.msg=t.data.APIRes.ResMessage,d.modalMsg.type=t.data.APIRes.ResCode)},function(t,e,a,o){r=!1}),n=m.findAllVwMPlayer(s.dataSource.searchCondition).then(function(t,e,a,o){"000"===t.data.APIRes.ResCode?s.dataSource.mPlayListData=t.data.Rows.ListData:(d.modalMsg.title="Message",d.modalMsg.msg=t.data.APIRes.ResMessage,d.modalMsg.type=t.data.APIRes.ResCode)},function(t,e,a,o){r=!1});Promise.all([t,e,a,o,n]).then(()=>{r?s.initChart():i.$broadcast("changeModalMsg")})},s.initChart=function(){for(var t=["Jan.","Feb.","Mar.","Apr.","May.","Jun.","Jul.","Aug.","Sep.","Oct.","Nov.","Dec."],e=(new Date).getMonth(),a=e-5;a<=e;a++)0<=a?(s.dataSource.arrMonth.push(t[a]),s.dataSource.arrMonthIdx.push(a)):(s.dataSource.arrMonth.push(t[a+12]),s.dataSource.arrMonthIdx.push(a+12));s.registerChart(),s.promotionChart(),s.cashRebateChart(),s.allGameWinLoseChart()},s.registerChart=function(){var t=[],a=[];s.dataSource.arrMonthIdx.forEach(e=>{t.push(s.dataSource.memberListData.filter(t=>new Date(t.CreateDate).getMonth()===e).length),a.push(s.dataSource.depositListData.filter(t=>new Date(t.CreateDate).getMonth()===e).length)}),echarts.init(document.getElementById("registerChart")).setOption(genBarOption("Register vs Deposit",s.dataSource.arrMonth,[{title:"Register",data:t,color:"#095971"},{title:"Deposit",data:a,color:"#71CFE0"}]))},s.promotionChart=function(){var t=[],a=[];s.dataSource.arrMonthIdx.forEach(e=>{t.push(s.dataSource.depositListData.filter(t=>new Date(t.CreateDate).getMonth()===e).reduce((t,e)=>t+parseFloat(e.Amount),0)),a.push(s.dataSource.mPromotionListData.filter(t=>new Date(t.JoinDate).getMonth()===e).reduce((t,e)=>t+parseFloat(e.BonusAmount),0))}),echarts.init(document.getElementById("promotionChart")).setOption(genLineBarOption("Promotion vs Deposit",s.dataSource.arrMonth,[{title:"Percent",type:"line",yIndex:0,data:t.map((t,e)=>(a[e]/t*100).toFixed(2)),color:"#E84855"},{title:"Deposit",type:"bar",yIndex:1,data:t,color:"#095971"},{title:"Promotion",type:"bar",yIndex:1,data:a,color:"#71CFE0"}]))},s.cashRebateChart=function(){var t=[],a=[],o=[];s.dataSource.arrMonthIdx.forEach(e=>{t.push(s.dataSource.cbrsListData.filter(t=>new Date(t.CreateDate).getMonth()===e).reduce(function(t,e){e=parseFloat(e.CashRebate);return 0<e?t+e:t},0)),a.push(s.dataSource.cbrsListData.filter(t=>new Date(t.CreateDate).getMonth()===e).reduce(function(t,e){e=parseFloat(e.CashBack);return 0<e?t+e:t},0)),o.push(s.dataSource.cbrsListData.filter(t=>new Date(t.CreateDate).getMonth()===e).reduce((t,e)=>t+parseFloat(-e.RecordMoney),0))}),echarts.init(document.getElementById("cashRebateChart")).setOption(genCashRebateOption("CashRebate vs Income",s.dataSource.arrMonth,[{title:"Income",type:"bar",yIndex:1,data:o,color:"#095971"},{title:"CashRebate",type:"bar",yIndex:1,data:t,color:"#71CFE0"},{title:"CashBack",type:"bar",yIndex:1,data:a,color:"#AA7700"}]))},s.allGameWinLoseChart=function(){for(var t=[],e=[],a=[],o=1;o<6;o++)t.push(s.dataSource.mPlayListData.filter(t=>t.LotteryClassID===o).reduce((t,e)=>t+parseFloat(e.Price),0)),e.push(s.dataSource.mPlayListData.filter(t=>t.LotteryClassID===o).reduce(function(t,e){var a=parseFloat(e.WinMoney);return e.IsWin?t+a:t},0)),a.push(s.dataSource.mPlayListData.filter(t=>t.LotteryClassID===o).reduce(function(t,e){var a=parseFloat(e.Price);return e.IsWin?t:t+a},0));var r=echarts.init(document.getElementById("allGameWinLoseChart"));r.setOption(genCashRebateOption("Win/Lose By Game Category",s.dataSource.arrGames,[{title:"T/Over",type:"bar",yIndex:1,data:t,color:"#AA7700"},{title:"Win",type:"bar",yIndex:1,data:e,color:"#095971"},{title:"Lose",type:"bar",yIndex:1,data:a,color:"#71CFE0"}])),r.on("click",function(t){s.oneGameWinLoseChart(t)})},s.oneGameWinLoseChart=function(e){var t=[],a=[],o=[],r=s.dataSource.mPlayListData.filter(t=>t.LotteryClassID===e.dataIndex+1);s.dataSource.arrMonthIdx.forEach(e=>{t.push(r.filter(t=>new Date(t.CreateDate).getMonth()===e).reduce((t,e)=>t+parseFloat(e.Price),0)),a.push(r.filter(t=>new Date(t.CreateDate).getMonth()===e).reduce(function(t,e){var a=parseFloat(e.WinMoney);return e.IsWin?t+a:t},0)),o.push(r.filter(t=>new Date(t.CreateDate).getMonth()===e).reduce(function(t,e){var a=parseFloat(e.Price);return e.IsWin?t:t+a},0))}),echarts.init(document.getElementById("oneGameWinLoseChart")).setOption(genCashRebateOption(e.name+" By Six Month",s.dataSource.arrMonth,[{title:"T/Over",type:"bar",yIndex:1,data:t,color:"#AA7700"},{title:"Win",type:"bar",yIndex:1,data:a,color:"#095971"},{title:"Lose",type:"bar",yIndex:1,data:o,color:"#71CFE0"}]))},e(s.init,300)}]);
"use strict";app.controller("indexController",["$scope","$rootScope","$location","$translate","localStorageService","$timeout","$http","$q","authService","$route","ngAuthSettings","platformService",function(o,i,a,e,t,n,r,s,u,d,l,c){o.authentication=u.authentication,o.ngAuthSettings=l,o.location=a,o.dataSource={menuList:[{Text:"Member",URL:"javascript:void(0)",DropDownList:!0,Items:[{Text:"MemberManage",URL:"#!/memberManage",DropDownList:!1},{Text:"SubAdminManage",URL:"#!/subAdminManage",DropDownList:!1}]},{Text:"Report",URL:"javascript:void(0)",DropDownList:!0,Items:[{Text:"WinLostReport",URL:"#!/betReport",DropDownList:!1},{Text:"OutstandingReport",URL:"#!/outstandingReport",DropDownList:!1,Enable:!0}]}],menuShow:!1,topBarShow:!1,selectMenu:{},modalMsg:{},subMenuIndex:-1,siteMapPath:"",memberInfo:{},languageRead:"en"},o.init=function(){i.memberInfo=t.get("UserInfo"),o.dataSource.memberInfo=i.memberInfo,t.get("LanguageRead")?(o.dataSource.languageRead=t.get("LanguageRead"),e.use(o.dataSource.languageRead)):t.set("LanguageRead",o.dataSource.languageRead),i.isLogin&&a.path("memberManage"),i.$broadcast("setMenuPermission")},n(o.init,100),o.logout=function(){var e={UserName:t.get("UserName")};u.logOut(e)},o.getPlatform=function(){var e=t.get("CompanyID");return c.get({ID:e}).then(function(e){e&&"000"===e.data.APIRes.ResCode&&t.set("PlatformSetting",e.data.Rows.QryData)},function(e){})},i.$on("getPlatform",function(){o.getPlatform()}),o.findPlatform=function(){return c.find({TypeCode:"API"}).then(function(r){if(r&&"000"===r.data.APIRes.ResCode&&r.data.Rows.ListData&&0<r.data.Rows.ListData.length){let e=r.data.Rows.ListData||[],a=window.location.origin,o=window.location.hostname,t=o;0===o.indexOf("www")&&(t=o.replace("www.","")),0===o.indexOf("agent")&&(t=o.replace("agent.","")),0===o.indexOf("master")&&(t=o.replace("master.",""));let n=t.split(".")[0];r=e.find(e=>-1<e.URL.indexOf(n));r?(l.platformID=r.ID,l.platformCode=r.ShortName,l.platformLogo=`${r.ShortName}-logo`):(l.platformID=3,l.platformCode="hl",l.platformLogo="hl-logo"),l.platformList=e.filter(e=>-1<e.URL.indexOf(a)),i.$broadcast("updatePlatformList")}},function(e){})},o.personProfile=function(){o.dataSource.subMenuIndex=-1,a.path("personProfile")},o.siteMapPath=function(e,a){"javascript:void(0)"===e.URL&&-1===a||(o.dataSource.selectMenu=e,o.dataSource.subMenuIndex=a,o.dataSource.siteMapPath=0<=a?e.Text+" ➔ "+e.Items[a].Text:e.Text)},o.changeLanguage=function(){e.use(o.dataSource.languageRead),t.set("LanguageRead",o.dataSource.languageRead)},i.$on("setMenuPermission",function(){let e=(t.get("MemberFunction")||{}).FunctionGroups||[];o.dataSource.menuList=[],e.forEach(a=>{if(a.IsBO){let e={Text:a.LKey,URL:a.FURL,DropDownList:!1,Enable:!0,Sort:a.Sort};a.DropDownFunction&&0<a.DropDownFunction.length&&(e.DropDownList=!0,e.Items=a.DropDownFunction.map(e=>({Text:e.LKey,URL:e.FURL,DropDownList:!1,Enable:!0,Sort:e.Sort}))),o.dataSource.menuList.push(e)}})}),i.$on("changeModalMsg",function(e,a){o.dataSource.modalMsg=l.modalMsg,a?$("#ModalCancel").show():$("#ModalCancel").hide(),$("#exampleModalLong").hasClass("in")||$("#ModalShow").click()}),i.$on("changeMenuShow",function(e){o.dataSource.topBarShow=l.topBarShow,o.dataSource.menuShow=l.menuShow}),i.$on("changeMemberInfo",function(e){i.memberInfo=t.get("UserInfo"),o.dataSource.memberInfo=i.memberInfo}),o.modalMsgConfirmEvent=function(e){$("#exampleModalLong").modal("hide"),e&&o.dataSource.modalMsg.callBack&&setTimeout(function(){i.$broadcast(o.dataSource.modalMsg.callBack)},500),o.dataSource.modalMsg.linkTo&&a.path(o.dataSource.modalMsg.linkTo)},i.valid=function(e){var a="";return e&&e.$invalid&&(e.$error.required&&(a+="Required：",e.$error.required.forEach(e=>{a+=e.$name+"."})),e.$error.myValidator&&(a&&(a+="<br>"),a+="Format Error：",e.$error.myValidator.forEach(e=>{a+=e.$name+"."})),l.modalMsg={},l.modalMsg.title="Message",l.modalMsg.msg=a,l.modalMsg.type="100",i.$broadcast("changeModalMsg",!1)),a}}]);
"use strict";app.controller("loginController",["$scope","$rootScope","$location","$timeout","localStorageService","blockUI","ngAuthSettings","authService","memberShipService",function(a,o,e,t,r,s,d,i,u){a.dataSource={pageStatus:"loginView",Language:[{text:"中文",values:"zh-TW"},{text:"English",values:"En"}],userDataObj:{UserName:"",Pwd:""},forgetPwdObj:{UserName:"",Email:""},isShowPwd:!1,isShowForget:!1,validObj:{},selPlatformCode:"",platformList:d.platformList},a.init=function(){d.topBarShow=!1,d.menuShow=!1,d.pagitationShow=!1,r.get("Remember")&&(a.dataSource.userDataObj.UserName=r.get("UserName"),a.dataSource.userDataObj.Pwd=r.get("Password"),a.dataSource.Remember=r.get("Remember")),r.get("ApiType")&&(d.apiType=r.get("ApiType"),a.dataSource.apiType=d.apiType),a.dataSource.selPlatformCode=r.get("PlatformCode"),d.platformCode=a.dataSource.selPlatformCode,a.genValidatorCode(),s.stop()},t(a.init,100),o.$on("updatePlatformList",function(){a.dataSource.platformList=d.platformList}),a.genValidatorCode=function(){u.genValidatorCode().then(function(e){"000"===e.data.APIRes.ResCode?a.dataSource.validObj=e.data.Rows:(d.modalMsg.title="forget Password",d.modalMsg.msg=e.data.APIRes.ResMessage,d.modalMsg.type=e.data.APIRes.ResCode,o.$broadcast("changeModalMsg",!1))},function(e){})},a.showEyeEvent=function(){a.dataSource.isShowPwd=!a.dataSource.isShowPwd,a.dataSource.isShowPwd?($("#pwdShow").addClass("active"),$("#pwd").prop("type","text")):($("#pwdShow").removeClass("active"),$("#pwd").prop("type","password"))},a.showForgetEvent=function(){a.dataSource.isShowForget=!a.dataSource.isShowForget},a.login=function(e){s.start(),o.valid(e)?s.stop():(a.dataSource.userDataObj.PlateForm="BackDesk",a.dataSource.userDataObj.InputCode=a.dataSource.validObj.InputCode,a.dataSource.userDataObj.ValidatorCode=a.dataSource.validObj.ValidatorCode,d.platformCode=a.dataSource.selPlatformCode,a.dataSource.Remember?(r.set("UserName",a.dataSource.userDataObj.UserName),r.set("Password",a.dataSource.userDataObj.Pwd),r.set("Remember",!0)):(r.remove("UserName"),r.remove("Password"),r.remove("Remember")),i.login(a.dataSource.userDataObj,a.dataSource.Remember))},a.forget=function(e){o.valid(e)||u.forgetPwd(a.dataSource.forgetPwdObj).then(function(e){"000"===e.data.APIRes.ResCode?(d.authToken=e.data.AuthToken,d.modalMsg.title="forget Password",d.modalMsg.msg="New password has been sent to your mail.",d.modalMsg.type=e.data.APIRes.ResCode):(d.modalMsg.title="forget Password",d.modalMsg.msg=e.data.APIRes.ResMessage,d.modalMsg.type=e.data.APIRes.ResCode,a.dataSource.errorMsg=e.data.APIRes.ResMessage),o.$broadcast("changeModalMsg",!1)},function(e){})},a.changeApiCode=function(){r.set("PlatformCode",a.dataSource.selPlatformCode),d.platformCode=a.dataSource.selPlatformCode},a.showLogin=function(){a.dataSource.pageStatus="loginView"},a.showRegister=function(){a.dataSource.pageStatus="registerView"}}]);
"use strict";app.controller("manualOpenLotteryController",["$scope","$rootScope","$location","$timeout","localStorageService","blockUI","ngAuthSettings","authService","lotteryService","gameRoomService",function(s,r,e,a,t,d,n,o,l,u){s.dataSource={searchCondition:{CurrentPage:1,PageSize:10,LotteryTypeID:-1},pageStatus:"officialPeriodView",selLotterys:[],openData:{},openedLotterys:[],resetData:{LotteryTypeData:null,oLottery:null,NewResult:null},manualOLotterys:[],selOLotterys:[],selLotteryTypeList:[],EditPassword:{isShow:!0,type:null,Pwd:null,ConfirmPwd:null},callBack:null,parameter:{},fourDRtpResult:[],isLoading:!1},s.init=function(){s.dataSource.memberInfo=t.get("UserInfo"),31===s.dataSource.memberInfo.AgentLevelSCID&&(s.dataSource.searchCondition.IsAgentGame=!0),s.searchGameRoomType(),s.changePageToManualView(),s.dateSearch(-4,0)},a(s.init,100),s.updateEditPassword=function(e){!r.valid(e)&&s.dataSource.EditPassword.type&&s.checkGamePwd()},s.checkPwd=function(e,a){("open"!==a&&"reset"!==a||confirm("Confirm to "+a+" lottery?"))&&e(a)},s.checkGamePwd=function(){s.dataSource.openData.GamePwd=s.dataSource.EditPassword.Pwd,l.checkGamePwd(s.dataSource.openData).then(function(e){"000"===e.data.APIRes.ResCode?s.dataSource.callBack(s.dataSource.parameter):(n.modalMsg.title="Message",n.modalMsg.msg=e.data.APIRes.ResMessage,n.modalMsg.type=e.data.APIRes.ResCode,r.$broadcast("changeModalMsg"))},function(e){console.log(e)})},s.openDialog=function(e){s.dataSource.openData.oLottery=e,$("#ShowOpenLottery").click()},s.open=function(){var e="";if(s.dataSource.openData.InputResult=s.dataSource.openData.InputResult1,s.dataSource.openData.InputResult1&&s.dataSource.openData.InputResult2&&s.dataSource.openData.InputResult3&&(s.dataSource.openData.InputResult=s.dataSource.openData.InputResult3+","+s.dataSource.openData.InputResult2+","+s.dataSource.openData.InputResult1),!s.dataSource.openData.InputResult||!s.dataSource.openData.oLottery||!s.dataSource.openData.oLottery.CurrentPeriod)return e+="Confirm all data is entered",n.modalMsg.title="Message",n.modalMsg.msg=e,void r.$broadcast("changeModalMsg");if(s.dataSource.openData.InputResult3&&(4!==`${s.dataSource.openData.InputResult3}`.trim().length||!Number(s.dataSource.openData.InputResult3)))return e+="wrong format. follow example : 1234",n.modalMsg.title="Message",n.modalMsg.msg=e,void r.$broadcast("changeModalMsg");if(s.dataSource.openData.InputResult2&&(4!==`${s.dataSource.openData.InputResult2}`.trim().length||!Number(s.dataSource.openData.InputResult2)))return e+="wrong format. follow example : 1234",n.modalMsg.title="Message",n.modalMsg.msg=e,void r.$broadcast("changeModalMsg");if(s.dataSource.openData.InputResult1&&(4!==`${s.dataSource.openData.InputResult1}`.trim().length||!Number(s.dataSource.openData.InputResult1)))return e+="wrong format. follow example : 1234",n.modalMsg.title="Message",n.modalMsg.msg=e,void r.$broadcast("changeModalMsg");e={InputResult:s.dataSource.openData.InputResult,CurrentPeriod:s.dataSource.openData.oLottery.CurrentPeriod,LotteryTypeID:s.dataSource.openData.oLottery.LotteryTypeID,GamePwd:s.dataSource.openData.GamePwd};d.start(),l.manualOpenLottery(e).then(function(e){"000"===e.data.APIRes.ResCode?(n.modalMsg.title="Message",n.modalMsg.msg=e.data.APIRes.ResMessage,n.modalMsg.type=e.data.APIRes.ResCode,r.$broadcast("changeModalMsg"),d.stop(),s.dataSource.openData={},s.searchManualOLottery()):(n.modalMsg.title="Message",n.modalMsg.msg=e.data.APIRes.ResMessage,n.modalMsg.type=e.data.APIRes.ResCode,r.$broadcast("changeModalMsg"),d.stop())},function(e){console.log(e),d.stop()})},s.searchGameRoomType=function(){d.start(),u.find({}).then(function(e,a,t,o){"000"===e.data.APIRes.ResCode?(s.dataSource.gameRoomTypeListData=e.data.Rows,s.dataSource.PagerObj=e.data.Rows.PagerObj,s.dataSource.EditPassword.isShow=!!s.dataSource.gameRoomTypeListData[0].GamePwd):(n.modalMsg.title="Message",n.modalMsg.msg=e.data.APIRes.ResMessage,n.modalMsg.type=e.data.APIRes.ResCode,r.$broadcast("changeModalMsg")),d.stop()},function(e){console.log(e),d.stop()})},s.dateSearch=function(e,a){var t=new Date,o=new Date(Number(t));o.setDate(t.getDate()+e);e=new Date(Number(t));e.setDate(t.getDate()+a),s.dataSource.searchCondition.DateS=o,s.dataSource.searchCondition.DateE=e,s.searchManualOLottery()},s.searchManualOLottery=function(){d.start(),l.findLotteryTypeByOfficial(s.dataSource.searchCondition).then(function(e){"000"===e.data.APIRes.ResCode?(s.dataSource.manualOLotterys=[],s.dataSource.selLotteryTypeList=[],e.data.Rows.forEach(a=>{s.dataSource.selLotteryTypeList.push({LotteryTypeName:a.LotteryTypeName,LotteryTypeID:a.LotteryTypeID}),a.OLotteries.forEach(e=>{e.IsAgentGame=a.IsAgentGame,s.dataSource.manualOLotterys.push({LotteryTypeName:a.LotteryTypeName,LotteryTypeID:a.LotteryTypeID,ID:e.ID,CurrentPeriod:e.CurrentPeriod,CurrentLotteryTime:new Date(e.CurrentLotteryTime),DrawLotteryTime:new Date(e.CloseTime).setSeconds(new Date(e.CloseTime).getSeconds()+30),CloseTime:new Date(e.CloseTime),IsAgentGame:a.IsAgentGame,Result:e.Result,ResultList:e.Result?e.Result.split(","):"",CanSetResult:new Date(e.CloseTime)<new Date&&!e.Result})})}),s.dataSource.officialPeriod=s.dataSource.selLotteryTypeList[0]):(n.modalMsg.title="Message",n.modalMsg.msg=e.data.APIRes.ResMessage,n.modalMsg.type=e.data.APIRes.ResCode,r.$broadcast("changeModalMsg"),s.dataSource.errorMsg=e.data.APIRes.ResMessage),d.stop()},function(e){console.log(e),d.stop()})},s.showOfficialPeriod=function(e){s.dataSource.officialPeriod=e||{},$("#ShowOffificalPeriod").click()},s.confirmOfficialPeriod=function(e,a){r.valid(e)||(a.CurrentLotteryTime=formatDate(a.CurrentLotteryTime,!0),a.CloseTime=formatDate(a.CloseTime,!0),0<a.ID?l.updateOLottery(a).then(function(e){"000"===e.data.APIRes.ResCode?(n.modalMsg.title="Message",n.modalMsg.msg=e.data.APIRes.ResMessage,n.modalMsg.type=e.data.APIRes.ResCode,r.$broadcast("changeModalMsg"),s.searchManualOLottery()):(n.modalMsg.title="Message",n.modalMsg.msg=e.data.APIRes.ResMessage,n.modalMsg.type=e.data.APIRes.ResCode,r.$broadcast("changeModalMsg"),s.dataSource.errorMsg=e.data.APIRes.ResMessage)},function(e){console.log(e)}):l.addOLottery(a).then(function(e){"000"===e.data.APIRes.ResCode?(n.modalMsg.title="Message",n.modalMsg.msg=e.data.APIRes.ResMessage,n.modalMsg.type=e.data.APIRes.ResCode,r.$broadcast("changeModalMsg"),s.searchManualOLottery()):(n.modalMsg.title="Message",n.modalMsg.msg=e.data.APIRes.ResMessage,n.modalMsg.type=e.data.APIRes.ResCode,r.$broadcast("changeModalMsg"),s.dataSource.errorMsg=e.data.APIRes.ResMessage)},function(e){console.log(e)}))},s.deleteOfficialPeriod=function(e){l.deleteOLottery(e).then(function(e){"000"===e.data.APIRes.ResCode?(n.modalMsg.title="Message",n.modalMsg.msg=e.data.APIRes.ResMessage,n.modalMsg.type=e.data.APIRes.ResCode,r.$broadcast("changeModalMsg"),s.searchManualOLottery()):(n.modalMsg.title="Message",n.modalMsg.msg=e.data.APIRes.ResMessage,n.modalMsg.type=e.data.APIRes.ResCode,r.$broadcast("changeModalMsg"),s.dataSource.errorMsg=e.data.APIRes.ResMessage)},function(e){console.log(e)})},s.changePageToManualView=function(){s.dataSource.pageStatus="officialPeriodView",d.start(),l.findLotteryTypeByOfficial({IsAgentGame:!0}).then(function(e){var a;"000"===e.data.APIRes.ResCode?(a=e.data.Rows,s.dataSource.selLotterys=a,s.dataSource.selLotterys.unshift({LotteryTypeID:-1,LotteryTypeName:"All"})):(n.modalMsg.title="Message",n.modalMsg.msg=e.data.APIRes.ResMessage,n.modalMsg.type=e.data.APIRes.ResCode,r.$broadcast("changeModalMsg"),s.dataSource.errorMsg=e.data.APIRes.ResMessage),d.stop()},function(e){console.log(e),d.stop()})},s.changePageToResetView=function(){s.dataSource.pageStatus="resetView",d.start(),l.findLotteryTypeByOfficial({IsAgentGame:!0}).then(function(e){var a;"000"===e.data.APIRes.ResCode?(a=e.data.Rows.ListData,s.dataSource.openedLotterys=a):(n.modalMsg.title="Message",n.modalMsg.msg=e.data.APIRes.ResMessage,n.modalMsg.type=e.data.APIRes.ResCode,r.$broadcast("changeModalMsg"),s.dataSource.errorMsg=e.data.APIRes.ResMessage),d.stop()},function(e){console.log(e),d.stop()})},s.reset=function(){var e="";if(s.dataSource.resetData.NewResult=s.dataSource.resetData.NewResult1,s.dataSource.resetData.NewResult1&&s.dataSource.resetData.NewResult2&&s.dataSource.resetData.NewResult3&&(s.dataSource.resetData.NewResult=s.dataSource.resetData.NewResult3+","+s.dataSource.resetData.NewResult2+","+s.dataSource.resetData.NewResult1),!(s.dataSource.resetData.NewResult&&s.dataSource.resetData.oLottery&&s.dataSource.resetData.oLottery.CurrentPeriod&&s.dataSource.resetData.LotteryTypeData&&s.dataSource.resetData.LotteryTypeData.LotteryTypeID))return e+="Confirm all data is entered",n.modalMsg.title="Message",n.modalMsg.msg=e,void r.$broadcast("changeModalMsg");if(s.dataSource.resetData.NewResult3&&(4!==`${s.dataSource.resetData.NewResult3}`.trim().length||!Number(s.dataSource.resetData.NewResult3)))return e+="wrong format. follow example : 1234",n.modalMsg.title="Message",n.modalMsg.msg=e,void r.$broadcast("changeModalMsg");if(s.dataSource.resetData.NewResult2&&(4!==`${s.dataSource.resetData.NewResult2}`.trim().length||!Number(s.dataSource.resetData.NewResult2)))return e+="wrong format. follow example : 1234",n.modalMsg.title="Message",n.modalMsg.msg=e,void r.$broadcast("changeModalMsg");if(s.dataSource.resetData.NewResult1&&(4!==`${s.dataSource.resetData.NewResult1}`.trim().length||!Number(s.dataSource.resetData.NewResult1)))return e+="wrong format. follow example : 1234",n.modalMsg.title="Message",n.modalMsg.msg=e,void r.$broadcast("changeModalMsg");e={NewResult:s.dataSource.resetData.NewResult,CurrentPeriod:s.dataSource.resetData.oLottery.CurrentPeriod,LotteryTypeID:s.dataSource.resetData.LotteryTypeData.LotteryTypeID};l.manualResetOLottery(e).then(function(e){"000"===e.data.APIRes.ResCode?(n.modalMsg.title="Message",n.modalMsg.msg=e.data.APIRes.ResMessage,n.modalMsg.type=e.data.APIRes.ResCode,r.$broadcast("changeModalMsg"),s.dataSource.resetData.NewResult="",s.changePageToResetView()):(n.modalMsg.title="Message",n.modalMsg.msg=e.data.APIRes.ResMessage,n.modalMsg.type=e.data.APIRes.ResCode,r.$broadcast("changeModalMsg"))},function(e){console.log(e)})},s.get4DRtpResult=function(e){if(!s.dataSource.openData.oLottery.UserWinPercentage)return n.modalMsg.title="Error",n.modalMsg.msg="Please set user win percentage first.",void r.$broadcast("changeModalMsg");s.dataSource.isLoading=!0,l.get4DRrpResult(e).then(function(e){s.dataSource.isLoading=!1,"000"===e.data.APIRes.ResCode?s.dataSource.fourDRtpResult=e.data.Rows.ListData:(n.modalMsg.title="Message",n.modalMsg.msg=e.data.APIRes.ResMessage,n.modalMsg.type=e.data.APIRes.ResCode,r.$broadcast("changeModalMsg"))},function(e){s.dataSource.isLoading=!1,console.log(e)})}}]);
"use strict";app.controller("memberManageController",["$scope","$rootScope","$location","$timeout","localStorageService","blockUI","ngAuthSettings","authService","memberShipService","systemConfigService","transactionsService","statementService",function(n,s,a,e,t,d,g,o,c,r,l,i){n.changeConsole=function(){console.log(n.dataSource.selMemberInfo)},n.dataSource={pageStatus:"searchView",searchCondition:{CurrentPage:1,PageSize:10,MemberUser:"",Address:"",Email:"",AgentLevelSCID:null},modalMsg:{},resetInfo:{},listData:[],transactionData:[],statementData:[],parentData:[{level:1,selData:{},listData:[]},{level:2,selData:{},listData:[]},{level:3,selData:{},listData:[]}],payTypeDropDown:[],memberInfo:{},selMemberInfo:{},selBank:{},selStatement:{},parentInfo:{agentParent:{},level:1,agentParentMap:[]},changePwdObj:{MemberOldPwd:"",MemberNewPwd:""},status:0,userTypeDropDown:[{text:"Please Choose",value:-1},{text:"System Manager",value:"0"},{text:"Customer Service",value:"1"},{text:"Agent",value:"2"}],agentLevelDropDown:[],showAgentLevelDropDown:[],isShowAddMemberPwd:!1,PagerObj:{CurrentPage:1,PageSize:10,TotalItems:0,PageArray:[],PageRangeMax:10,PageRangeMin:1,thisPage:1},PagerObj2:{CurrentPage:1,PageSize:10,TotalItems:0,PageArray:[],PageRangeMax:10,PageRangeMin:1,thisPage:1},PagerObj3:{CurrentPage:1,PageSize:10,TotalItems:0,PageArray:[],PageRangeMax:10,PageRangeMin:1,thisPage:1},platformOptions:[],platformID:0,IsSpecialAgent:!1},n.init=function(){var e;g.menuShow=!0,g.pagitationShow=!0,n.editType="/memberManage"===a.path()?"editView":"personEditView",n.dataSource.pageStatus="/memberManage"===a.path()?"searchView":"editView",n.dataSource.memberInfo=t.get("UserInfo"),n.dataSource.IsSpecialAgent=n.dataSource.memberInfo.IsSpecialAgent,n.dataSource.memberInfo&&"searchView"!==n.dataSource.pageStatus&&n.showEdit(n.dataSource.memberInfo),n.dataSource.platformOptions=(t.get("PlatformSettings")||[]).map(e=>({label:e.PlatformName,value:"API"===e.TypeCode?e.APICode:e.ShortName,ID:e.ID,TypeCode:e.TypeCode})),38!==n.dataSource.memberInfo.AgentLevelSCID&&39!==n.dataSource.memberInfo.AgentLevelSCID||(e=n.dataSource.memberInfo.AgentParentMap.split("/"),n.dataSource.memberInfo.UserName=e[e.length-2],n.dataSource.memberInfo.MemberID=n.dataSource.memberInfo.AgentParentID),n.dataSource.platformID=n.dataSource.platformOptions.find(e=>"HL"===e.value)?.ID,n.dropDownInit()},n.dropDownInit=function(){var e=r.findSystemConfigChildren({ListConfigName:["PayType"]}).then(function(e,a,t){"000"===e.data.APIRes.ResCode?(n.dataSource.payTypeDropDown=e.data.Rows.ListData,n.dataSource.payTypeDropDown.unshift({ID:-1,ConfigName:"Please Choose"})):(g.modalMsg.title="Message",g.modalMsg.msg=e.data.APIRes.ResMessage,g.modalMsg.type=e.data.APIRes.ResCode,s.$broadcast("changeModalMsg",!1))},function(e){console.log(e),d.stop()}),a=r.findSystemConfigChildren({ListConfigName:["AgentLevel"]}).then(function(e,a,t){"000"===e.data.APIRes.ResCode?n.dataSource.agentLevelDropDown=e.data.Rows.ListData.filter(e=>"5"!==e.ConfigValues):(g.modalMsg.title="Message",g.modalMsg.msg=e.data.APIRes.ResMessage,g.modalMsg.type=e.data.APIRes.ResCode,s.$broadcast("changeModalMsg",!1))},function(e){console.log(e),d.stop()}),t=r.findSystemConfigChildren({ListConfigName:["DepositType","WithDrawalType"]}).then(function(e,a,t){"000"===e.data.APIRes.ResCode?n.dataSource.transactionTypeDropDown=e.data.Rows.ListData:(g.modalMsg.title="Message",g.modalMsg.msg=e.data.APIRes.ResMessage,g.modalMsg.type=e.data.APIRes.ResCode,s.$broadcast("changeModalMsg",!1))},function(e){console.log(e),d.stop()});Promise.all([e,a,t]).then(()=>{"personEditView"!==n.editType&&n.search(),n.dataSource.memberInfo&&"searchView"!==n.dataSource.pageStatus&&n.showEdit(n.dataSource.memberInfo)})},e(n.init,100),n.search=function(e){d.start();let a={UserName:n.dataSource.searchCondition.UserName,Email:n.dataSource.searchCondition.Email,Phone:n.dataSource.searchCondition.Phone,AgentParentID:n.dataSource.memberInfo.MemberID,CurrentPage:n.dataSource.PagerObj.CurrentPage,PageSize:n.dataSource.PagerObj.PageSize,IsStaging:IS_STAGING};31!==n.dataSource.memberInfo.AgentLevelSCID&&39!==n.dataSource.memberInfo.AgentLevelSCID||(a.AgentLevelSCID=32),e&&(a.IsUpdateBalance=!0),n.dataSource.listData=[],c.findUser(a).then(function(e,a,t){d.stop(),"000"===e.data.APIRes.ResCode?(n.dataSource.listData=e.data.Rows.ListData,n.dataSource.PagerObj=e.data.Rows.PagerObj,n.dataSource.PagerObj.thisPage=n.dataSource.PagerObj.CurrentPage,n.dataSource.PagerObj.thisPageSize=n.dataSource.PagerObj.PageSize,n.dataSource.PagerObj.PageArray=[]):(g.modalMsg.title="Message",g.modalMsg.msg=e.data.APIRes.ResMessage,g.modalMsg.type=e.data.APIRes.ResCode,s.$broadcast("changeModalMsg",!1))},function(e,a,t){d.stop()})},n.searchParent=function(e,r){d.start();var a={};a.CurrentPage=n.dataSource.PagerObj.CurrentPage,a.PageSize=n.dataSource.PagerObj.PageSize,a.UserName=e,a.IsTree=!0,c.getUser(a).then(function(e,a,t){var o;"000"===e.data.APIRes.ResCode?((o=n.dataSource.parentData.find(e=>e.level===r)).listData=e.data.Rows.SubNodes,o.listData.unshift({MemberID:-1,UserName:"Please Choose"}),n.dataSource.parentInfo.agentParentMap[r]?o.listData.forEach((e,a)=>{e.UserName===n.dataSource.parentInfo.agentParentMap[r]&&(o.selData=o.listData[a])}):o.selData=o.listData[0],n.changeParent(o,r+1)):(g.modalMsg.title="Message",g.modalMsg.msg=e.data.APIRes.ResMessage,g.modalMsg.type=e.data.APIRes.ResCode,s.$broadcast("changeModalMsg",!1)),d.stop()},function(e,a,t){d.stop()})},n.changeParent=function(e,t){var o,e=e.selData,r=n.dataSource.parentData.find(e=>e.level===t);if(t<n.dataSource.parentInfo.level)for(var a=n.dataSource.parentInfo.level-t+1,s=0;s<a;s++)n.dataSource.parentInfo.agentParentMap.pop();-1===e.MemberID?(n.dataSource.parentInfo.level=t-1,n.dataSource.parentInfo.agentParent=2===t?n.dataSource.memberInfo:n.dataSource.parentData.find(e=>e.level===t-2).selData):(n.dataSource.parentInfo.level=t,n.dataSource.parentInfo.agentParent=e,n.dataSource.parentInfo.agentParentMap.includes(e.UserName)||n.dataSource.parentInfo.agentParentMap.push(e.UserName),4!==t&&(r.listData=e.SubNodes,r.listData||(r.listData=[]),0===r.listData.filter(e=>-1===e.MemberID).length&&r.listData.unshift({MemberID:-1,UserName:"Please Choose"}),n.dataSource.parentInfo.agentParentMap[t]?(o=!1,r.listData.forEach((e,a)=>{e.UserName===n.dataSource.parentInfo.agentParentMap[t]&&(r.selData=r.listData[a],n.changeParent(r,t+1),o=!0)}),o||(r.selData=r.listData[0])):r.selData=r.listData[0]))},n.changeAgentLevel=function(){n.dataSource.parentInfo.level=n.dataSource.agentLevelDropDown.filter(e=>e.ID===parseInt(n.dataSource.selMemberInfo.AgentLevelSCID))[0].ConfigValues-1},n.clear=function(){n.dataSource.searchCondition={}},n.showSearch=function(){var e;n.dataSource.pageStatus="searchView",n.dataSource.parentInfo={agentParent:{},level:1,agentParentMap:[]},n.dataSource.memberInfo=t.get("UserInfo"),38!==n.dataSource.memberInfo.AgentLevelSCID&&39!==n.dataSource.memberInfo.AgentLevelSCID||(e=n.dataSource.memberInfo.AgentParentMap.split("/"),n.dataSource.memberInfo.UserName=e[e.length-2],n.dataSource.memberInfo.MemberID=n.dataSource.memberInfo.AgentParentID),n.search()},n.$on("showSearch",n.showSearch),n.showAdd=function(){n.dataSource.pageStatus="addView";var a=n.dataSource.agentLevelDropDown.filter(e=>e.ID===n.dataSource.memberInfo.AgentLevelSCID)[0].ConfigValues;n.dataSource.showAgentLevelDropDown=n.dataSource.agentLevelDropDown.filter(e=>e.ConfigValues>parseInt(a)&&e.ConfigValues<=parseInt(a)+1&&38!==e.ID&&39!==e.ID),n.dataSource.showAgentLevelDropDown.unshift({ID:-1,ConfigName:"Please Choose"}),n.dataSource.parentInfo.agentParent=n.dataSource.memberInfo,n.dataSource.status=n.dataSource.memberInfo.AgentLevelValue,n.dataSource.parentInfo.level=n.dataSource.status,n.dataSource.selMemberInfo={};var e="",e=n.dataSource.parentInfo.agentParent.AgentParentMap?n.dataSource.parentInfo.agentParent.AgentParentMap+n.dataSource.parentInfo.agentParent.UserName+"/":n.dataSource.parentInfo.agentParent.UserName;n.dataSource.selMemberInfo.AgentParentMap=e,n.dataSource.selMemberInfo.AgentParentName=n.dataSource.parentInfo.agentParent.UserName,n.dataSource.selMemberInfo.AgentParentID=n.dataSource.parentInfo.agentParent.MemberID,n.dataSource.selMemberInfo.UserType=-1,n.dataSource.selMemberInfo.AgentLevelSCID=39,n.dataSource.selMemberInfo.ReferralPayType=-1,n.dataSource.selMemberInfo.CashRebatePayType=-1,n.dataSource.selMemberInfo.CashBackRebatePayType=-1,n.dataSource.selMemberInfo.IsEditEmail=!1,n.dataSource.selMemberInfo.IsEditPhone=!0;e=e.split("/");e.forEach(e=>{e&&n.dataSource.parentInfo.agentParentMap.push(e)}),n.searchParent(e[0],1)},n.showEdit=function(e){n.dataSource.pageStatus=n.editType,n.dataSource.status=e.AgentLevelValue-2,e.Birthday&&(e.Birthday=new Date(e.Birthday)),e.ReferralPayType&&(e.ReferralPayType=parseInt(e.ReferralPayType)),e.CashBackPayType&&(e.CashBackPayType=parseInt(e.CashBackPayType)),e.CashRebatePayType&&(e.CashRebatePayType=parseInt(e.CashRebatePayType)),$.extend(n.dataSource.selMemberInfo,e),$.extend(n.dataSource.resetInfo,n.dataSource.selMemberInfo),n.dataSource.showAgentLevelDropDown=n.dataSource.agentLevelDropDown.filter(e=>e.ID===n.dataSource.selMemberInfo.AgentLevelSCID);e=(e.UserName||"").split("_");1<e.length&&(n.dataSource.selMemberInfo.Account=e[1]);e=n.dataSource.selMemberInfo.AgentParentMap.split("/");n.dataSource.selMemberInfo.AgentParentName=e[e.length-2],n.dataSource.parentInfo.agentParent.UserName=n.dataSource.selMemberInfo.AgentParentName,n.dataSource.parentInfo.agentParent.MemberID=n.dataSource.selMemberInfo.AgentParentID,e.forEach(function(e){e&&n.dataSource.parentInfo.agentParentMap.push(e)}),e[0]?n.searchParent(e[0],1):n.searchParent("Admin",1)},n.resetInfo=function(){$.extend(n.dataSource.selMemberInfo,n.dataSource.resetInfo)},n.deleteMember=function(e){n.dataSource.selMemberInfo=e,g.modalMsg.title="Confirm",g.modalMsg.msg="Confirm Delete?",g.modalMsg.type="000",g.modalMsg.callBack="confirmDel",s.$broadcast("changeModalMsg",!0)},n.$on("confirmDel",function(e){c.delMember(n.dataSource.selMemberInfo).then(function(e,a,t){"000"===e.data.APIRes.ResCode?(g.modalMsg.title="Message",g.modalMsg.msg=e.data.APIRes.ResMessage,g.modalMsg.type=e.data.APIRes.ResCode,g.modalMsg.callBack="showSearch",s.$broadcast("changeModalMsg",!1),n.search()):(g.modalMsg.title="Message",g.modalMsg.msg=e.data.APIRes.ResMessage,g.modalMsg.type=e.data.APIRes.ResCode,s.$broadcast("changeModalMsg",!1),n.dataSource.errorMsg=e.data.APIRes.ResMessage)},function(e,a,t){})}),n.addMember=function(e){if(!s.valid(e)){if(n.dataSource.selMemberInfo.Pwd!==n.dataSource.selMemberInfo.ConfirmPwd)return g.modalMsg.title="Alert",g.modalMsg.msg="Password And ConfirmPassword Is Different",void s.$broadcast("changeModalMsg",!1);e={};$.extend(e,n.dataSource.selMemberInfo),e.UserName=g.platformCode+"_"+e.Account,e.PlatformSettingIDs=[n.dataSource.platformID],d.start(),c.addMember(e).then(function(e){"000"===e.data.APIRes.ResCode?(g.modalMsg.title="Message",g.modalMsg.msg=e.data.APIRes.ResMessage,g.modalMsg.type=e.data.APIRes.ResCode,g.modalMsg.callBack="showSearch",s.$broadcast("changeModalMsg",!1),n.search()):(g.modalMsg.title="Message",g.modalMsg.msg=e.data.APIRes.ResMessage,g.modalMsg.type=e.data.APIRes.ResCode,s.$broadcast("changeModalMsg",!1),n.dataSource.errorMsg=e.data.APIRes.ResMessage),d.stop()},function(e){d.stop()})}},n.saveMember=function(e){s.valid(e)||c.updateUser(n.dataSource.selMemberInfo).then(function(e){"000"===e.data.APIRes.ResCode?(g.modalMsg.title="Message",g.modalMsg.msg=e.data.APIRes.ResMessage,g.modalMsg.type=e.data.APIRes.ResCode):(g.modalMsg.title="Message",g.modalMsg.msg=e.data.APIRes.ResMessage,g.modalMsg.type=e.data.APIRes.ResCode,n.dataSource.errorMsg=e.data.APIRes.ResMessage),s.$broadcast("changeModalMsg",!1)},function(e){})},n.savePwd=function(e){if(!s.valid(e))return n.dataSource.changePwdObj.MemberNewPwd!==n.dataSource.changePwdObj.ConfirmPwd?(g.modalMsg.title="Alert",g.modalMsg.msg="NewPassword And ConfirmPassword Is Different",void s.$broadcast("changeModalMsg",!1)):n.dataSource.changePwdObj.MemberOldPwd===n.dataSource.changePwdObj.MemberNewPwd?(g.modalMsg.title="Alert",g.modalMsg.msg="MemberOldPwd And MemberNewPwd Can't Be Same",void s.$broadcast("changeModalMsg",!1)):void c.changePwdMember(n.dataSource.changePwdObj).then(function(e){"000"===e.data.APIRes.ResCode?(g.modalMsg.title="Message",g.modalMsg.msg=e.data.APIRes.ResMessage,g.modalMsg.type=e.data.APIRes.ResCode,g.modalMsg.callBack="showSearch"):(g.modalMsg.title="Message",g.modalMsg.msg=e.data.APIRes.ResMessage,g.modalMsg.type=e.data.APIRes.ResCode,n.dataSource.errorMsg=e.data.APIRes.ResMessage),s.$broadcast("changeModalMsg",!1)},function(e){})},n.resetPwd=function(){confirm("Confirm reset password?")&&c.forgetPwd(n.dataSource.selMemberInfo).then(function(e){"000"===e.data.APIRes.ResCode?(g.authToken=e.data.AuthToken,g.modalMsg.title="forget Password",g.modalMsg.msg="New password has been sent to your mail.",g.modalMsg.type=e.data.APIRes.ResCode,o.fillAuthData()):(g.modalMsg.title="forget Password",g.modalMsg.msg=e.data.APIRes.ResMessage,g.modalMsg.type=e.data.APIRes.ResCode,n.dataSource.errorMsg=e.data.APIRes.ResMessage),s.$broadcast("changeModalMsg",!1)},function(e){})},n.changeAndSave=function(e){n.dataSource.selMemberInfo=e,n.saveMember()},n.showChangePassword=function(e){e.isShowChangePassword=!0,e.MemberNewPwd="",e.NewPwdError="",e.clickChangePwd=!1},n.showEyeEvent=function(e){e.isShowPwd=!e.isShowPwd},n.showAddMemberEyeEvent=function(){n.dataSource.isShowAddMemberPwd=!n.dataSource.isShowAddMemberPwd},n.changePassword=function(e,a){a.clickChangePwd=!0,s.valid(e)||(e={MemberID:a.MemberID,UserName:a.UserName,MemberNewPwd:a.MemberNewPwd},c.changeGameDealerPwdMemberByBack(e).then(function(e){"000"===e.data.APIRes.ResCode?(g.modalMsg.title="Message",g.modalMsg.msg=e.data.APIRes.ResMessage,g.modalMsg.type=e.data.APIRes.ResCode,a.isShowChangePassword=!1,s.$broadcast("changeModalMsg",!1)):a.NewPwdError=e.data.APIRes.ResMessage},function(e){}))},n.deleteBank=function(){confirm("Confirm刪除?")&&bankService.delBank(n.dataSource.selBank).then(function(e){"000"===e.data.APIRes.ResCode?(g.modalMsg.title="Message",g.modalMsg.msg=e.data.APIRes.ResMessage,g.modalMsg.type=e.data.APIRes.ResCode,s.$broadcast("changeModalMsg",!1),n.search()):(g.modalMsg.title="Message",g.modalMsg.msg=e.data.APIRes.ResMessage,g.modalMsg.type=e.data.APIRes.ResCode,s.$broadcast("changeModalMsg",!1),n.dataSource.errorMsg=e.data.APIRes.ResMessage)},function(e){})},n.showTransaction=function(){n.dataSource.pageStatus="transactionView",n.dataSource.PagerObj2.CurrentPage=1,n.dataSource.PagerObj2.PageSize=10,n.dataSource.searchCondition.CurrentPage=n.dataSource.PagerObj2.CurrentPage,n.dataSource.searchCondition.PageSize=n.dataSource.PagerObj2.PageSize,n.dataSource.searchCondition.MemberID=n.dataSource.selMemberInfo.MemberID,l.findTransactionsHistory(n.dataSource.searchCondition).then(function(e,a,t){"000"===e.data.APIRes.ResCode?(console.log(e.data.Rows.ListData),n.dataSource.transactionData=e.data.Rows.ListData,n.dataSource.PagerObj2=e.data.Rows.PagerObj,n.dataSource.PagerObj2.thisPage=n.dataSource.PagerObj.CurrentPage,n.dataSource.PagerObj2.thisPageSize=n.dataSource.PagerObj.PageSize,n.dataSource.PagerObj2.PageArray=[]):(g.modalMsg.title="Message",g.modalMsg.msg=e.data.APIRes.ResMessage,g.modalMsg.type=e.data.APIRes.ResCode,s.$broadcast("changeModalMsg",!1))},function(e,a,t){})},n.showStatement=function(){n.dataSource.pageStatus="statementView";var e={CurrentPage:n.dataSource.PagerObj3.CurrentPage,PageSize:n.dataSource.PagerObj3.PageSize,LotteryType:n.dataSource.searchCondition.LotteryType,DateS:n.dataSource.searchCondition.DateS,DateE:n.dataSource.searchCondition.DateE,Status:n.dataSource.searchCondition.Status,MemberID:n.dataSource.selMemberInfo.MemberID};i.findStatement(e).then(function(e){"000"===e.data.APIRes.ResCode?(n.dataSource.statementData=e.data.Rows.ListData,n.dataSource.PagerObj3=e.data.Rows.PagerObj,n.dataSource.PagerObj3.thisPage=n.dataSource.PagerObj.CurrentPage,n.dataSource.PagerObj3.thisPageSize=n.dataSource.PagerObj.PageSize,n.dataSource.PagerObj3.PageArray=[]):(g.modalMsg.title="Error",g.modalMsg.msg=e.data.APIRes.Msg,g.modalMsg.type=e.data.APIRes.ResCode,g.modalMsg.callBack="",s.$broadcast("changeModalMsg")),d.stop()},function(e){d.stop()})},n.showDetail=function(e,a){n.dataSource.selStatement=e},n.confirmAgent=function(){var e="";switch(n.dataSource.selMemberInfo.AgentLevelSCID){case 30:2!==n.dataSource.parentInfo.agentParentMap.length&&(e="Please Choose Agent SM.");break;case 31:3!==n.dataSource.parentInfo.agentParentMap.length&&(e="Please Choose Agent M.");break;case 32:4!==n.dataSource.parentInfo.agentParentMap.length&&(e="Please Choose Agent AG.")}if(e)return g.modalMsg.title="Msg",g.modalMsg.msg=e,void s.$broadcast("changeModalMsg");n.dataSource.selMemberInfo.AgentParentName=n.dataSource.parentInfo.agentParent.UserName,n.dataSource.selMemberInfo.AgentParentID=n.dataSource.parentInfo.agentParent.MemberID,n.dataSource.selMemberInfo.AgentParentMap=n.dataSource.parentInfo.agentParentMap.join("/")+"/"},n.PageChanged=function(e){n.dataSource.PagerObj.CurrentPage=e,n.search()},n.PageChanged2=function(e){n.dataSource.PagerObj2.CurrentPage=e,n.showTransaction()},n.PageChanged3=function(e){n.dataSource.PagerObj3.CurrentPage=e,n.showStatement()}}]);
"use strict";app.controller("NotFindController",["$scope","$rootScope","$location","$timeout","blockUI","ngAuthSettings","authService",function(t,e,n,o,i,c,s){i.start(),t.dataSource={Language:[{text:"中文",values:"zh-TW"},{text:"English",values:"En"}],firstNowIndex:-1,secondNowIndex:-1,contisionCodeSet:[{text:"是",values:"true"},{text:"否",values:"false"}],modalMsg:{}},t.initSearchSet=function(){},t.init=function(){o(function(){i.stop()},1e3)},o(function(){t.init()},10)}]);
"use strict";app.controller("outstandingReportController",["$scope","$rootScope","$location","$timeout","localStorageService","blockUI","ngAuthSettings","authService","lotteryService","mplayerService","memberShipService",function(u,i,t,e,a,n,s,o,l,r,d){var g=new Date,c=new Date(Number(g));function p(e){console.log("filterDrawListData_Start_"+new Date);var o=e.map(t=>t.SelectedNums.replace(/X/g,"")).filter((t,e,a)=>a.indexOf(t)===e).sort();console.log(o);for(var i=[],n=0;n<o.length;n++){let t=e.filter(t=>t.SelectedNums.replace(/X/g,"")===o[n]),a=t.map(t=>t.LotteryInfoID);var s=a.filter(function(t,e){return a.indexOf(t)===e});t&&0<t.length&&i.push({idx:o[n],value:t.map(t=>t.TotalPending).reduce((t,e)=>t+e),LotteryInfoID:t[0].LotteryInfoID,LotteryInfoIDs:s})}return console.log("filterDrawListData_End_"+new Date),i}function S(a,o,i,n){console.log("setShowListData_Start_"+new Date);for(var s=[],l=1,r=0;r<a.length;r++){let t=a[r];var d=t.idx.toString().padStart(i,0);let e=_(1,d,t.LotteryInfoIDs);s.push({key:d,value:t.value,positionTaking:0<e.length?e.map(t=>t.TotalPending).reduce((t,e)=>t+e):0,LotteryInfoID:t.LotteryInfoID,LotteryInfoIDs:t.LotteryInfoIDs,keyValue:d}),r%n==n-1&&(o.push({idx:l,list:s}),l++,s=[])}0<s.length&&o.push({idx:l,list:s}),u.dataSource.allShowListData=o.slice(),console.log("setShowListData_End_"+new Date)}function D(){for(var t=[],e=0;e<10;e++)t.push({idx:e,text:e,value:0,positionTaking:0});return t}function _(t,e,a,o){var i=[];switch(t){case 1:i=u.dataSource.positionTakingListData.filter(t=>t.SelectedNums.replace(/X/g,"")===e&&a.includes(t.LotteryInfoID));break;case 2:i=u.dataSource.positionTakingListData.filter(t=>t.SelectedNums===e&&a.includes(t.LotteryInfoID));break;case 3:i=u.dataSource.positionTakingListData.filter(t=>t.SelectedNums.split("_")[0]===e&&t.SelectedNums.split("_")[1]===o&&a.includes(t.LotteryInfoID));break;case 4:i=u.dataSource.positionTakingListData.filter(t=>t.SelectedNums.split(",")[0]===e&&t.SelectedNums.split(",")[1]===o&&a.includes(t.LotteryInfoID))}return i=28===u.dataSource.memberInfo.AgentLevelSCID?i.filter(t=>t.MemberID===u.dataSource.memberInfo.MemberID||t.GameDealerMemberID===u.dataSource.memberInfo.MemberID):i.filter(t=>"Platform"===s.apiType?t.MemberID===u.dataSource.memberInfo.MemberID:t.GameDealerMemberID===u.dataSource.memberInfo.MemberID)}c.setDate(g.getDate()-2),u.dataSource={pageStatus:"4D",searchCondition:{CurrentPage:1,PageSize:1e6,DateS:c,DateE:new Date},memberInfo:{},tableNameList:[],positionTakingListData:[],positionTakingMaps:[],fileName:"",listData_4D:[],listData_3D:[],listData_2D:[],listData_colokBebas:[],listData_colokBebas2D:[],listData_colokNaga:[],listData_colokJitu:[],listData_tengah:[],listData_dasar:[],listData_5050:[],listData_50502D:[],listData_shio:[],listData_silang:[],listData_kembang:[],listData_kombinasi:[],listData_kombinasi_1st2nd:[{type:"_",text:"",rows:[]},{type:"Big_1st",text:"TA",rows:[{type:"Title",text:"",value:"Big_2nd"},{type:"Big",text:"TA",value:0,positionTaking:0},{type:"Small",text:"HSIAO",value:0,positionTaking:0},{type:"Odd",text:"TAN",value:0,positionTaking:0},{type:"Even",text:"SHUANG",value:0,positionTaking:0}]},{type:"Small_1st",text:"HSIAO",rows:[{type:"Title",text:"",value:"Small_2nd"},{type:"Big",text:"TA",value:0,positionTaking:0},{type:"Small",text:"HSIAO",value:0,positionTaking:0},{type:"Odd",text:"TAN",value:0,positionTaking:0},{type:"Even",text:"SHUANG",value:0,positionTaking:0}]},{type:"Odd_1st",text:"TAN",rows:[{type:"Title",text:"",value:"Odd_2nd"},{type:"Big",text:"TA",value:0,positionTaking:0},{type:"Small",text:"HSIAO",value:0,positionTaking:0},{type:"Odd",text:"TAN",value:0,positionTaking:0},{type:"Even",text:"SHUANG",value:0,positionTaking:0}]},{type:"Even_1st",text:"SHUANG",rows:[{type:"Title",text:"",value:"Even_2nd"},{type:"Big",text:"TA",value:0,positionTaking:0},{type:"Small",text:"HSIAO",value:0,positionTaking:0},{type:"Odd",text:"TAN",value:0,positionTaking:0},{type:"Even",text:"SHUANG",value:0,positionTaking:0}]}],listData_kombinasi_3rd4th:[{type:"_",rows:[]},{type:"Big_3rd",text:"TA",rows:[{type:"Title",text:"",value:"Big_4th"},{type:"Big",text:"TA",value:0,positionTaking:0},{type:"Small",text:"HSIAO",value:0,positionTaking:0},{type:"Odd",text:"TAN",value:0,positionTaking:0},{type:"Even",text:"SHUANG",value:0,positionTaking:0}]},{type:"Small_3rd",text:"HSIAO",rows:[{type:"Title",text:"",value:"Small_4th"},{type:"Big",text:"TA",value:0,positionTaking:0},{type:"Small",text:"HSIAO",value:0,positionTaking:0},{type:"Odd",text:"TAN",value:0,positionTaking:0},{type:"Even",text:"SHUANG",value:0,positionTaking:0}]},{type:"Odd_3rd",text:"TAN",rows:[{type:"Title",text:"",value:"Odd_4th"},{type:"Big",text:"TA",value:0,positionTaking:0},{type:"Small",text:"HSIAO",value:0,positionTaking:0},{type:"Odd",text:"TAN",value:0,positionTaking:0},{type:"Even",text:"SHUANG",value:0,positionTaking:0}]},{type:"Even_3rd",text:"SHUANG",rows:[{type:"Title",text:"",value:"Even_4th"},{type:"Big",text:"TA",value:0,positionTaking:0},{type:"Small",text:"HSIAO",value:0,positionTaking:0},{type:"Odd",text:"TAN",value:0,positionTaking:0},{type:"Even",text:"SHUANG",value:0,positionTaking:0}]}],listData_kombinasi_combination:[{type:"_",text:"",rows:[]},{type:"Big_1st",text:"TA_3rd",rows:[{type:"Title",text:"",value:"Big_3rd"},{type:"Big_1st",text:"TA_1st",value:0,positionTaking:0},{type:"Small_1st",text:"HSIAO_1st",value:0,positionTaking:0},{type:"Odd_1st",text:"TAN_1st",value:0,positionTaking:0},{type:"Even_1st",text:"SHUANG_1st",value:0,positionTaking:0},{type:"Big_2nd",text:"TA_2nd",value:0,positionTaking:0},{type:"Small_2nd",text:"HSIAO_2nd",value:0,positionTaking:0},{type:"Odd_2nd",text:"TAN_2nd",value:0,positionTaking:0},{type:"Even_2nd",text:"SHUANG_2nd",value:0,positionTaking:0}]},{type:"Small_1st",text:"HSIAO_3rd",rows:[{type:"Title",text:"",value:"Small_3rd"},{type:"Big_1st",text:"TA_1st",value:0,positionTaking:0},{type:"Small_1st",text:"HSIAO_1st",value:0,positionTaking:0},{type:"Odd_1st",text:"TAN_1st",value:0,positionTaking:0},{type:"Even_1st",text:"SHUANG_1st",value:0,positionTaking:0},{type:"Big_2nd",text:"TA_2nd",value:0,positionTaking:0},{type:"Small_2nd",text:"HSIAO_2nd",value:0,positionTaking:0},{type:"Odd_2nd",text:"TAN_2nd",value:0,positionTaking:0},{type:"Even_2nd",text:"SHUANG_2nd",value:0,positionTaking:0}]},{type:"Odd_1st",text:"TAN_3rd",rows:[{type:"Title",text:"",value:"Odd_3rd"},{type:"Big_1st",text:"TA_1st",value:0,positionTaking:0},{type:"Small_1st",text:"HSIAO_1st",value:0,positionTaking:0},{type:"Odd_1st",text:"TAN_1st",value:0,positionTaking:0},{type:"Even_1st",text:"SHUANG_1st",value:0,positionTaking:0},{type:"Big_2nd",text:"TA_2nd",value:0,positionTaking:0},{type:"Small_2nd",text:"HSIAO_2nd",value:0,positionTaking:0},{type:"Odd_2nd",text:"TAN_2nd",value:0,positionTaking:0},{type:"Even_2nd",text:"SHUANG_2nd",value:0,positionTaking:0}]},{type:"Even_1st",text:"SHUANG_3rd",rows:[{type:"Title",text:"",value:"Even_3rd"},{type:"Big_1st",text:"TA_1st",value:0,positionTaking:0},{type:"Small_1st",text:"HSIAO_1st",value:0,positionTaking:0},{type:"Odd_1st",text:"TAN_1st",value:0,positionTaking:0},{type:"Even_1st",text:"SHUANG_1st",value:0,positionTaking:0},{type:"Big_2nd",text:"TA_2nd",value:0,positionTaking:0},{type:"Small_2nd",text:"HSIAO_2nd",value:0,positionTaking:0},{type:"Odd_2nd",text:"TAN_2nd",value:0,positionTaking:0},{type:"Even_2nd",text:"SHUANG_2nd",value:0,positionTaking:0}]},{type:"Big_2nd",text:"TA_4th",rows:[{type:"Title",text:"",value:"Big_4th"},{type:"Big_1st",text:"TA_1st",value:0,positionTaking:0},{type:"Small_1st",text:"HSIAO_1st",value:0,positionTaking:0},{type:"Odd_1st",text:"TAN_1st",value:0,positionTaking:0},{type:"Even_1st",text:"SHUANG_1st",value:0,positionTaking:0},{type:"Big_2nd",text:"TA_2nd",value:0,positionTaking:0},{type:"Small_2nd",text:"HSIAO_2nd",value:0,positionTaking:0},{type:"Odd_2nd",text:"TAN_2nd",value:0,positionTaking:0},{type:"Even_2nd",text:"SHUANG_2nd",value:0,positionTaking:0}]},{type:"Small_2nd",text:"HSIAO_4th",rows:[{type:"Title",text:"",value:"Small_4th"},{type:"Big_1st",text:"TA_1st",value:0,positionTaking:0},{type:"Small_1st",text:"HSIAO_1st",value:0,positionTaking:0},{type:"Odd_1st",text:"TAN_1st",value:0,positionTaking:0},{type:"Even_1st",text:"SHUANG_1st",value:0,positionTaking:0},{type:"Big_2nd",text:"TA_2nd",value:0,positionTaking:0},{type:"Small_2nd",text:"HSIAO_2nd",value:0,positionTaking:0},{type:"Odd_2nd",text:"TAN_2nd",value:0,positionTaking:0},{type:"Even_2nd",text:"SHUANG_2nd",value:0,positionTaking:0}]},{type:"Odd_2nd",text:"TAN_4th",rows:[{type:"Title",text:"",value:"Odd_4th"},{type:"Big_1st",text:"TA_1st",value:0,positionTaking:0},{type:"Small_1st",text:"HSIAO_1st",value:0,positionTaking:0},{type:"Odd_1st",text:"TAN_1st",value:0,positionTaking:0},{type:"Even_1st",text:"SHUANG_1st",value:0,positionTaking:0},{type:"Big_2nd",text:"TA_2nd",value:0,positionTaking:0},{type:"Small_2nd",text:"HSIAO_2nd",value:0,positionTaking:0},{type:"Odd_2nd",text:"TAN_2nd",value:0,positionTaking:0},{type:"Even_2nd",text:"SHUANG_2nd",value:0,positionTaking:0}]},{type:"Even_2nd",text:"SHUANG_4th",rows:[{type:"Title",text:"",value:"Even_4th"},{type:"Big_1st",text:"TA_1st",value:0,positionTaking:0},{type:"Small_1st",text:"HSIAO_1st",value:0,positionTaking:0},{type:"Odd_1st",text:"TAN_1st",value:0,positionTaking:0},{type:"Even_1st",text:"SHUANG_1st",value:0,positionTaking:0},{type:"Big_2nd",text:"TA_2nd",value:0,positionTaking:0},{type:"Small_2nd",text:"HSIAO_2nd",value:0,positionTaking:0},{type:"Odd_2nd",text:"TAN_2nd",value:0,positionTaking:0},{type:"Even_2nd",text:"SHUANG_2nd",value:0,positionTaking:0}]}],allShowListData:[],showListData:[],betListData:[],selLotteryTypeList:[],lotteryInfoListData:[],PagerObj:{CurrentPage:1,PageSize:10,TotalItems:0,PageArray:[],PageRangeMax:10,PageRangeMin:1,thisPage:1}},e(function(){u.init()},100),u.init=function(){u.dataSource.memberInfo=a.get("UserInfo"),u.initData(),u.searchLotteryType(),u.searchPositionTakingMap()},u.initData=function(){var t=0;for(u.dataSource.listData_colokBebas.push({idx:-1,text:"Number",value:"Value",positionTaking:"P.T"}),t=0;t<10;t++)u.dataSource.listData_colokBebas.push({idx:t,text:t,value:0,positionTaking:0});u.dataSource.listData_colokJitu.push({text:"1st",list:D()}),u.dataSource.listData_colokJitu.push({text:"2nd",list:D()}),u.dataSource.listData_colokJitu.push({text:"3rd",list:D()}),u.dataSource.listData_colokJitu.push({text:"4th",list:D()})},u.setData=function(t){u.dataSource.showListData=[],u.dataSource.listData_colokBebas2D=[],u.dataSource.listData_colokNaga=[],u.dataSource.tableNameList=[];var e,s=[];console.log("setData_Start_"+new Date),"4D"!==t&&"3D"!==t&&"2D"!==t&&"ColokBebas2D"!==t&&"ColokNaga"!==t&&"Depan2D"!==t&&"Tengah2D"!==t||("4D"===t&&(u.dataSource.fileName="4D",u.dataSource.tableNameList.push("table_4D"),S(p(s=u.dataSource.betListData.filter(t=>"4D"===t.LotteryInfoName)),u.dataSource.showListData,4,10)),"3D"===t&&(u.dataSource.fileName="4D",u.dataSource.tableNameList.push("table_4D"),S(p(s=u.dataSource.betListData.filter(t=>"3D"===t.LotteryInfoName)),u.dataSource.showListData,3,10)),"2D"===t&&(e=["2D","2D-B/S-Front","2D-O/E-Front","2D-B/S-Middle","2D-O/E-Middle","2D-B/S-Back","2D-O/E-Back"],u.dataSource.fileName="4D",u.dataSource.tableNameList.push("table_4D"),S(p(s=u.dataSource.betListData.filter(t=>e.includes(t.LotteryInfoName))),u.dataSource.showListData,2,10)),"Depan2D"===t&&(u.dataSource.fileName="4D",u.dataSource.tableNameList.push("table_4D"),S(p(s=u.dataSource.betListData.filter(t=>"2D-Front"===t.LotteryInfoName.split("_")[0])),u.dataSource.showListData,2,5)),"Tengah2D"===t&&(u.dataSource.fileName="4D",u.dataSource.tableNameList.push("table_4D"),S(p(s=u.dataSource.betListData.filter(t=>"2D-Middle"===t.LotteryInfoName.split("_")[0])),u.dataSource.showListData,2,5)),"ColokBebas2D"===t&&(u.dataSource.fileName="ColokBebas2D",u.dataSource.tableNameList.push("table_4D"),S(p(s=u.dataSource.betListData.filter(t=>"4D-Two-Any"===t.LotteryInfoName)),u.dataSource.listData_colokBebas2D,2,5)),"ColokNaga"===t&&(u.dataSource.fileName="ColokBebas2D",u.dataSource.tableNameList.push("table_ColokBebas2D"),S(p(s=u.dataSource.betListData.filter(t=>"4D-Three-Any"===t.LotteryInfoName)),u.dataSource.listData_colokNaga,3,5)),console.log("setData_End_"+new Date)),"ColokBebas"===t&&(u.dataSource.fileName="ColokBebas",u.dataSource.tableNameList.push("table_ColokBebas"),s=u.dataSource.betListData.filter(t=>"4D-One-Any"===t.LotteryInfoName),u.dataSource.listData_colokBebas.forEach(e=>{var a=s.filter(t=>t.SelectedNums.replace("X","")===e.text.toString());let o=a.map(t=>t.LotteryInfoID);var i=o.filter(function(t,e){return o.indexOf(t)===e});if(a&&0<a.length){let t=_(1,e.text.toString(),i);e.value=a.map(t=>t.TotalPending).reduce((t,e)=>t+e),e.positionTaking=0<t.length?t.map(t=>t.TotalPending).reduce((t,e)=>t+e):0,e.LotteryInfoID=a[0].LotteryInfoID,e.LotteryInfoIDs=i,e.keyValue=a[0].SelectedNums.replace(/X/g,"")}})),"ColokJitu"===t&&(u.dataSource.fileName="ColokJitu",u.dataSource.tableNameList.push("table_ColokJitu"),s=u.dataSource.betListData.filter(t=>"4D-Position"===t.LotteryInfoName),u.dataSource.listData_colokJitu.forEach(n=>{n.list.forEach(e=>{var a=s.filter(t=>t.SelectedNums.split("_")[0]===e.text.toString()&&t.SelectedNums.split("_")[1]===n.text);let o=a.map(t=>t.LotteryInfoID);var i=o.filter(function(t,e){return o.indexOf(t)===e});if(a&&0<a.length){let t=_(3,e.text.toString(),i,n.text);e.value=a.map(t=>t.TotalPending).reduce((t,e)=>t+e),e.positionTaking=0<t.length?t.map(t=>t.TotalPending).reduce((t,e)=>t+e):0,e.LotteryInfoID=a[0].LotteryInfoID,e.LotteryInfoIDs=i,e.keyValue=a[0].SelectedNums}})})),"Kombinasi"===t&&(u.dataSource.fileName="Kombinasi",u.dataSource.tableNameList.push("table_Kombinasi_1&2"),u.dataSource.tableNameList.push("table_Kombinasi_3&4"),u.dataSource.tableNameList.push("table_Kombinasi_combination"),u.dataSource.listData_kombinasi=u.dataSource.lotteryInfoListData.filter(t=>"Kombinasi"===t.FamliyBigID),u.dataSource.listData_kombinasi.forEach(e=>{var t=u.dataSource.betListData.filter(t=>t.LotteryInfoName===e.LotteryInfoName);switch(e.LotteryInfoName){case"4D-1st,2nd":u.dataSource.listData_kombinasi_1st2nd.forEach(n=>{n.rows.forEach(e=>{var a=t.filter(t=>t.SelectedNums.split(",")[0]===n.text.toString()&&t.SelectedNums.split(",")[1]===e.text);let o=a.map(t=>t.LotteryInfoID);var i=o.filter(function(t,e){return o.indexOf(t)===e});if(a&&0<a.length){let t=_(4,n.text.toString(),i,e.text);e.value=a.map(t=>t.TotalPending).reduce((t,e)=>t+e),e.positionTaking=0<t.length?t.map(t=>t.TotalPending).reduce((t,e)=>t+e):0,e.LotteryInfoID=a[0].LotteryInfoID,e.LotteryInfoIDs=i,e.keyValue=a[0].SelectedNums}})});break;case"4D-3rd,4th":u.dataSource.listData_kombinasi_3rd4th.forEach(n=>{n.rows.forEach(e=>{var a=t.filter(t=>t.SelectedNums.split(",")[0]===n.text.toString()&&t.SelectedNums.split(",")[1]===e.text);let o=a.map(t=>t.LotteryInfoID);var i=o.filter(function(t,e){return o.indexOf(t)===e});if(a&&0<a.length){let t=_(4,n.text.toString(),i,e.text);e.value=a.map(t=>t.TotalPending).reduce((t,e)=>t+e),e.positionTaking=0<t.length?t.map(t=>t.TotalPending).reduce((t,e)=>t+e):0,e.LotteryInfoID=a[0].LotteryInfoID,e.LotteryInfoIDs=i,e.keyValue=a[0].SelectedNums}})});break;case"4D-1st&2nd,3rd&4th":u.dataSource.listData_kombinasi_combination.forEach(n=>{n.rows.forEach(e=>{var a=t.filter(t=>t.SelectedNums.split(",")[0]===e.text&&t.SelectedNums.split(",")[1]===n.text.toString());let o=a.map(t=>t.LotteryInfoID);var i=o.filter(function(t,e){return o.indexOf(t)===e});if(a&&0<a.length){let t=_(4,e.text,i,n.text.toString());e.value=a.map(t=>t.TotalPending).reduce((t,e)=>t+e),e.positionTaking=0<t.length?t.map(t=>t.TotalPending).reduce((t,e)=>t+e):0,e.LotteryInfoID=a[0].LotteryInfoID,e.LotteryInfoIDs=i,e.keyValue=a[0].SelectedNums}})})}})),"Others"===t&&(u.dataSource.fileName="Others",u.dataSource.tableNameList.push("table_tengah"),u.dataSource.tableNameList.push("table_dasar"),u.dataSource.tableNameList.push("table_fifty_fifty"),u.dataSource.tableNameList.push("table_fifty_fifty2D"),u.dataSource.tableNameList.push("table_shio"),u.dataSource.tableNameList.push("table_silang"),u.dataSource.tableNameList.push("table_kembang"),u.dataSource.listData_tengah=u.dataSource.lotteryInfoListData.filter(t=>"Tengah"===t.FamliyBigID),u.setInfoList(u.dataSource.listData_tengah),u.dataSource.listData_dasar=u.dataSource.lotteryInfoListData.filter(t=>"Dasar"===t.FamliyBigID),u.setInfoList(u.dataSource.listData_dasar),u.dataSource.listData_5050=u.dataSource.lotteryInfoListData.filter(t=>"50-50"===t.FamliyBigID),u.setInfoList(u.dataSource.listData_5050),u.dataSource.listData_50502D=u.dataSource.lotteryInfoListData.filter(t=>"50-50 2D"===t.FamliyBigID),u.setInfoList(u.dataSource.listData_50502D),u.dataSource.listData_shio=u.dataSource.lotteryInfoListData.filter(t=>"Shio"===t.FamliyBigID),u.setInfoList(u.dataSource.listData_shio),u.dataSource.listData_silang=u.dataSource.lotteryInfoListData.filter(t=>"Silang"===t.FamliyBigID),u.setInfoList(u.dataSource.listData_silang),u.dataSource.listData_kembang=u.dataSource.lotteryInfoListData.filter(t=>"Kembang"===t.FamliyBigID),u.setInfoList(u.dataSource.listData_kembang))},u.setInfoList=function(t){t.forEach(e=>{var t=u.dataSource.betListData.filter(t=>t.LotteryInfoName===e.LotteryInfoName);e.listData.forEach(e=>{e.rvalue=0,e.positionTaking=0;var a=t.filter(t=>t.SelectedNums===e.value.toString());let o=a.map(t=>t.LotteryInfoID);var i=o.filter(function(t,e){return o.indexOf(t)===e});if(a&&0<a.length){let t=_(2,e.value.toString(),i);e.rvalue=a.map(t=>t.TotalPending).reduce((t,e)=>t+e),e.positionTaking=0<t.length?t.map(t=>t.TotalPending).reduce((t,e)=>t+e):0,e.LotteryInfoID=a[0].LotteryInfoID,e.LotteryInfoIDs=i,e.keyValue=a[0].SelectedNums}})})},u.changeReport=function(t){var e;u.dataSource.pageStatus=t,e=u.dataSource.PagerObj,u.dataSource.PagerObj={CurrentPage:e.CurrentPage,PageSize:e.PageSize,TotalItems:e.TotalItems,PageArray:[],thisPage:e.CurrentPage,thisPageSize:e.PageSize},u.setData(u.dataSource.pageStatus),"4D"===t&&(u.dataSource.showListData=u.dataSource.allShowListData.slice((u.dataSource.PagerObj.CurrentPage-1)*u.dataSource.PagerObj.PageSize,u.dataSource.PagerObj.PageSize*u.dataSource.PagerObj.CurrentPage),u.dataSource.PagerObj.TotalItems=u.dataSource.allShowListData.length),"3D"===t&&(u.dataSource.showListData=u.dataSource.allShowListData.slice((u.dataSource.PagerObj.CurrentPage-1)*u.dataSource.PagerObj.PageSize,u.dataSource.PagerObj.PageSize*u.dataSource.PagerObj.CurrentPage),u.dataSource.PagerObj.TotalItems=u.dataSource.allShowListData.length),"2D"===t&&(u.dataSource.showListData=u.dataSource.allShowListData.slice((u.dataSource.PagerObj.CurrentPage-1)*u.dataSource.PagerObj.PageSize,u.dataSource.PagerObj.PageSize*u.dataSource.PagerObj.CurrentPage),u.dataSource.PagerObj.TotalItems=u.dataSource.allShowListData.length),"ColokBebas2D"===t&&(u.dataSource.showListData=u.dataSource.listData_colokBebas2D.slice((u.dataSource.PagerObj.CurrentPage-1)*u.dataSource.PagerObj.PageSize,u.dataSource.PagerObj.PageSize*u.dataSource.PagerObj.CurrentPage),u.dataSource.PagerObj.TotalItems=u.dataSource.listData_colokBebas2D.length),"ColokNaga"===t&&(u.dataSource.showListData=u.dataSource.listData_colokNaga.slice((u.dataSource.PagerObj.CurrentPage-1)*u.dataSource.PagerObj.PageSize,u.dataSource.PagerObj.PageSize*u.dataSource.PagerObj.CurrentPage),u.dataSource.PagerObj.TotalItems=u.dataSource.listData_colokNaga.length)},u.search=function(){n.start(),u.dataSource.searchCondition.IsDetailReport=!0,u.dataSource.searchCondition.ShowPending=!0,u.dataSource.searchCondition.IsStaging=IS_STAGING,r.findOutStandingReport(u.dataSource.searchCondition).then(function(t,e,a,o){"000"===t.data.APIRes.ResCode?(u.dataSource.betListData=t.data.Rows.filter(t=>0===t.MemberID&&0===t.GameDealerMemberID),u.dataSource.positionTakingListData=t.data.Rows.filter(t=>0<t.MemberID||0<t.GameDealerMemberID),u.searchLotteryInfo()):(s.modalMsg.title="Message",s.modalMsg.msg=t.data.APIRes.ResMessage,s.modalMsg.type=t.data.APIRes.ResCode,i.$broadcast("changeModalMsg")),n.stop()},function(t){console.log(t),n.stop()})},u.searchLotteryType=function(){var t={CurrentPage:1,PageSize:1e3,LotteryClassID:5};l.findLotteryType(t).then(function(t,e,a,o){"000"===t.data.APIRes.ResCode?(u.dataSource.selLotteryTypeList=t.data.Rows.ListData,u.dataSource.searchCondition.LotteryTypeID=u.dataSource.selLotteryTypeList[0].LotteryTypeID,u.search()):(s.modalMsg.title="Message",s.modalMsg.msg=t.data.APIRes.ResMessage,s.modalMsg.type=t.data.APIRes.ResCode,i.$broadcast("changeModalMsg"))},function(t){console.log(t)})},u.searchLotteryInfo=function(){l.findLotteryInfo(u.dataSource.searchCondition).then(function(t,e,a,o){"000"===t.data.APIRes.ResCode?(u.dataSource.lotteryInfoListData=t.data.Rows.ListData,u.dataSource.lotteryInfoListData.forEach(t=>{t.listData=JSON.parse(t.SelectArray)}),u.changeReport(u.dataSource.pageStatus)):(s.modalMsg.title="Message",s.modalMsg.msg=t.data.APIRes.ResMessage,s.modalMsg.type=t.data.APIRes.ResCode,i.$broadcast("changeModalMsg"))},function(t){console.log(t)})},u.searchPositionTakingMap=function(){d.findMPositionProfitMap({CurrentPage:1,PageSize:1e5}).then(function(t,e,a,o){"000"===t.data.APIRes.ResCode?u.dataSource.positionTakingMaps=t.data.Rows.ListData:(s.modalMsg.title="Message",s.modalMsg.msg=t.data.APIRes.ResMessage,s.modalMsg.type=t.data.APIRes.ResCode,i.$broadcast("changeModalMsg"))},function(t){console.log(t)})},u.showDetail=function(t){u.dataSource.selInfo=t;var e=new Date,a=new Date(Number(e));a.setDate(e.getDate()-3);var o=new Date(Number(e));o.setDate(e.getDate());o={CurrentPage:1,PageSize:1e5,ByReport:!0,LotteryInfoIDs:t.LotteryInfoIDs,SelectNums:t.keyValue,StatusCode:0,DateS:a,DateE:o,IsStaging:IS_STAGING};n.start(),l.findVwMPlayerReport(o).then(function(t){"000"===t.data.APIRes.ResCode?(u.dataSource.mPlayerObj=t.data.Rows.ListData,u.dataSource.mPlayerObj.forEach(e=>{var t,a=u.dataSource.positionTakingMaps.filter(t=>t.AgentParentMap===(void 0===e.Member?"":e.Member.AgentParentMap)),o=[];(o=28===u.dataSource.memberInfo.AgentLevelSCID?a.find(t=>t.MemberID===u.dataSource.memberInfo.MemberID||t.GameDealerMemberID===u.dataSource.memberInfo.MemberID):a.find(t=>"Platform"===s.apiType?t.MemberID===u.dataSource.memberInfo.MemberID:t.GameDealerMemberID===u.dataSource.memberInfo.MemberID))&&(t=a[a.indexOf(o)+1],e.DownLineName=o.AgentParentMap.split("/")[a.indexOf(t)],e.DownLinePositionTaking=e.BetAmounts*o.PositionTakingProfit)}),$("#ShowDetailDialog").click()):(s.modalMsg.title="Information",s.modalMsg.msg=t.data.APIRes.ResMessage,s.modalMsg.type=t.data.APIRes.ResCode,s.modalMsg.callBack="home",i.$broadcast("changeModalMsg"),$("#ModalShow").click()),n.stop()},function(t){console.log(t)})},u.PageChanged=function(t){u.dataSource.PagerObj.CurrentPage=t,u.changeReport(u.dataSource.pageStatus)},u.copy=function(){var t=document.body;copy(t,document,u.dataSource.fileName)},u.excel=function(){excel(document,u.dataSource.tableNameList,u.dataSource.fileName+".xls")},u.print=function(){print(document,u.dataSource.fileName)}}]);
"use strict";app.controller("subAdminManageController",["$scope","$rootScope","$location","$timeout","localStorageService","blockUI","ngAuthSettings","memberShipService","mGroupService",function(s,o,e,a,t,r,d,n,i){s.dataSource={pageStatus:"searchView",searchCondition:{CurrentPage:1,PageSize:10},ConfirmMsg:{},clickRegister:!1,functionGroupList:[],selMemberInfo:{},listData:[],PagerObj:{CurrentPage:1,PageSize:10,TotalItems:0,PageArray:[],PageRangeMax:10,PageRangeMin:1,thisPage:1}},s.init=function(){s.dataSource.memberInfo=t.get("UserInfo"),s.search(),s.defaultFunctionGroups()},a(s.init,100),s.defaultFunctionGroups=function(){let e=((t.get("MemberFunction")||{}).MGroup||{}).FunctionGroups||[];s.dataSource.functionGroupList=[],e.forEach(t=>{if(0<t.ParentID){let a=s.dataSource.functionGroupList.find(e=>e.ID===t.ParentID);if(a){a.subView||(a.subView=[]);let e=a.subView.find(e=>e.GroupA===t.GroupA);e&&t.GroupA?(t.IsRead||(e.EditID=t.ID),t.IsRead&&(e.ViewID=t.ID)):(t.EditID=-1,t.ViewID=-1,t.IsRead||(t.EditID=t.ID),t.IsRead&&(t.ViewID=t.ID),a.subView.push(t))}}else t.EditID=t.ID,s.dataSource.functionGroupList.push(t)})},s.search=function(){var e={AgentLevelSCID:IS_MASTER?38:39,CurrentPage:s.dataSource.PagerObj.CurrentPage,PageSize:s.dataSource.PagerObj.PageSize};r.start(),n.findUser(e).then(function(e){"000"===e.data.APIRes.ResCode?(s.dataSource.listData=e.data.Rows.ListData,s.dataSource.PagerObj=e.data.Rows.PagerObj,s.dataSource.PagerObj.thisPage=s.dataSource.PagerObj.CurrentPage,s.dataSource.PagerObj.thisPageSize=s.dataSource.PagerObj.PageSize,s.dataSource.PagerObj.PageArray=[]):(d.modalMsg.title="Message",d.modalMsg.msg=e.data.APIRes.ResMessage,d.modalMsg.type=e.data.APIRes.ResCode,o.$broadcast("changeModalMsg")),r.stop()},function(){r.stop()})},s.add=function(a){if(s.dataSource.clickRegister=!0,!o.valid(a)){if(s.dataSource.selMemberInfo.Pwd!==s.dataSource.selMemberInfo.ConfirmPwd)return s.dataSource.ConfirmMsg.Pwd=s.dataSource.ConfirmMsg.ConfirmPwd="PasswordDifferentDetail",d.modalMsg.title="Alert",d.modalMsg.msg="PasswordDifferentDetail",void o.$broadcast("changeModalMsg",!1);a=s.dataSource.memberInfo;let e={Account:s.dataSource.selMemberInfo.Account,FullName:s.dataSource.selMemberInfo.FullName,NickName:s.dataSource.selMemberInfo.FullName,Pwd:s.dataSource.selMemberInfo.Pwd,AgentLevelSCID:IS_MASTER?38:39,AgentParentID:a.MemberID,AgentParentMap:a.AgentParentMap+a.UserName+"/",selPlatformCode:d.platformCode,ReferralPayType:a.ReferralPayType,CashRebatePayType:a.CashRebatePayType,CashBackRebatePayType:a.CashBackRebatePayType,PlatformSettingIDs:[]};e.UserName=e.Account,r.start(),n.addMember(e).then(function(e){"000"===e.data.APIRes.ResCode?(s.dataSource.clickRegister=!1,d.modalMsg.title="Message",d.modalMsg.msg=e.data.APIRes.ResMessage,d.modalMsg.type=e.data.APIRes.ResCode,e.data.Rows&&e.data.Rows.MemberID?setTimeout(function(){r.stop(),s.updateFunctionGroup(e.data.Rows.MemberID)},1e3):(r.stop(),o.$broadcast("changeModalMsg"),d.modalMsg.callBack="showSearch")):(d.modalMsg.title="Message",d.modalMsg.msg=e.data.APIRes.ResMessage,d.modalMsg.type=e.data.APIRes.ResCode,o.$broadcast("changeModalMsg"),s.dataSource.errorMsg=e.data.APIRes.ResMessage,r.stop())},function(e){r.stop()})}},s.getMGroup=function(e){e={CurrentPage:1,PageSize:1e5,MGroupID:e};r.start(),i.get(e).then(function(t){if("000"===t.data.APIRes.ResCode){s.dataSource.clickRegister=!1;let e=t.data.Rows.QryData.FunctionGroups||[],a=e.map(e=>e.ID);s.dataSource.functionGroupList.forEach(e=>{0<=e.EditID&&a.includes(e.EditID)?e.IsCanEdit=!0:e.IsCanEdit=!1,e.subView&&0<e.subView.length&&e.subView.forEach(e=>{e.IsCanEdit=!1,e.IsCanView=!1,0<=e.EditID&&a.includes(e.EditID)&&(e.IsCanEdit=!0),0<=e.ViewID&&a.includes(e.ViewID)&&(e.IsCanView=!0)})}),r.stop()}else d.modalMsg.title="Message",d.modalMsg.msg=t.data.APIRes.ResMessage,d.modalMsg.type=t.data.APIRes.ResCode,o.$broadcast("changeModalMsg"),s.dataSource.errorMsg=t.data.APIRes.ResMessage,r.stop()},function(e){r.stop()})},s.changeAndSave=function(e){s.dataSource.selMemberInfo=e,s.update(null,!1)},s.update=function(e,a){if(s.dataSource.clickRegister=!0,!o.valid(e)){if((s.dataSource.selMemberInfo.Pwd||s.dataSource.selMemberInfo.ConfirmPwd)&&s.dataSource.selMemberInfo.Pwd!==s.dataSource.selMemberInfo.ConfirmPwd)return s.dataSource.ConfirmMsg.Pwd=s.dataSource.ConfirmMsg.ConfirmPwd="PasswordDifferentDetail",d.modalMsg.title="Alert",d.modalMsg.msg="PasswordDifferentDetail",void o.$broadcast("changeModalMsg",!1);e={};$.extend(e,s.dataSource.selMemberInfo),r.start(),n.updateUser(e).then(function(e){"000"===e.data.APIRes.ResCode?(s.dataSource.clickRegister=!1,d.modalMsg.title="Message",d.modalMsg.msg=e.data.APIRes.ResMessage,d.modalMsg.type=e.data.APIRes.ResCode,d.modalMsg.callBack="showSearch",o.$broadcast("changeModalMsg"),r.stop(),a&&s.updateFunctionGroup(s.dataSource.selMemberInfo.MemberID)):(d.modalMsg.title="Message",d.modalMsg.msg=e.data.APIRes.ResMessage,d.modalMsg.type=e.data.APIRes.ResCode,o.$broadcast("changeModalMsg"),s.dataSource.errorMsg=e.data.APIRes.ResMessage,r.stop())},function(e){r.stop()})}},s.updateFunctionGroup=function(e){let a=[];s.dataSource.functionGroupList.forEach(e=>{e.IsCanEdit&&a.push(e.EditID),e.subView&&0<e.subView.length&&e.subView.forEach(e=>{e.IsCanEdit&&a.push(e.EditID),e.IsCanView&&a.push(e.ViewID)})});e={FunctionIDs:a,MemberID:e,IsGameDealer:!0};r.start(),i.updateFunctionGroupByMember(e).then(function(e){"000"===e.data.APIRes.ResCode?(d.modalMsg.title="Message",d.modalMsg.msg=e.data.APIRes.ResMessage,d.modalMsg.type=e.data.APIRes.ResCode,d.modalMsg.callBack="showSearch",o.$broadcast("changeModalMsg")):(d.modalMsg.title="Message",d.modalMsg.msg=e.data.APIRes.ResMessage,d.modalMsg.type=e.data.APIRes.ResCode,o.$broadcast("changeModalMsg"),s.dataSource.errorMsg=e.data.APIRes.ResMessage),r.stop()},function(e){r.stop()})},s.changeViewGroupCheckbox=function(a){a.subView&&0<a.subView.length&&a.subView.forEach(e=>{e.IsEnable=a.IsCanEdit,0<=e.EditID&&(e.IsCanEdit=a.IsCanEdit),0<=e.ViewID&&(e.IsCanView=a.IsCanEdit)})},s.changeSubViewCheckBox=function(e){!e.IsCanView&&0<=e.EditID&&(e.IsCanEdit=e.IsCanView)},s.changeSubEditCheckBox=function(e){e.IsCanEdit&&0<=e.ViewID&&(e.IsCanView=e.IsCanEdit)},s.showEyeEvent=function(){s.dataSource.isShowMemberPwd=!s.dataSource.isShowMemberPwd},s.showAdd=function(){s.dataSource.pageStatus="addView",s.dataSource.selMemberInfo={},s.dataSource.clickRegister=!1,s.getMGroup(IS_MASTER?6:7)},s.showEdit=function(e){s.dataSource.pageStatus="editView",$.extend(s.dataSource.selMemberInfo,e),s.dataSource.clickRegister=!1,s.getMGroup(e.MGroupID);var a=(e.UserName||"").split("_");(!IS_MASTER||s.dataSource.isShowPlatform)&&1<a.length?(s.dataSource.selMemberInfo.Account=a[1],s.dataSource.selMemberInfo.selPlatformCode=a[0]):(s.dataSource.selMemberInfo.Account=e.UserName,s.dataSource.selMemberInfo.selPlatformCode="")},s.showSearch=function(){s.dataSource.pageStatus="searchView",s.search()},s.$on("showSearch",s.showSearch),s.PageChanged=function(e){s.dataSource.PagerObj.CurrentPage=e,s.search()}}]);